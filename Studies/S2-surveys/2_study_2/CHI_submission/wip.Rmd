---
title: "VIBES STUDY 2 DESCRIPTIVES"
author: "ANONYMIZED"
date: "2024-08-07"
output:
  html_document:
    theme: flatly
    code_folding: hide
    fig_caption: yes
    number_sections: yes
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    toc_depth: 5
  pdf_document:
    toc: yes
    toc_depth: '4'
always_allow_html: yes
font-family: DejaVu Sans
mainfont: DejaVu Sans
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#UTILITIES
library(Hmisc) # %nin% operator
library(psych) #describe()
library(tidyverse) #all the things
library(magrittr) #special pipes like %<>%
library(summarytools) #data quality
library(lubridate) #dealing with dates

#EDA
library(qacBase)

#VIZ
library(kableExtra) #printing tables
library(ggformula) #regression syntax viz
# library(vcd) #mosaic plots
# library(vcdExtra) #mosaic plot helpers
library(ggstatsplot) #dummies
library(GGally) #extends ggplot for EDA 
library(ggeasy) #easy labelling
library(ggh4x) #guides [dual axes]
library(patchwork) #multi-plot layout
library(ggdist) #raincloud plots and other distributionals
library(ggridges) #ridge plots
library(viridis) #color palettes
library(RColorBrewer) #color palettes
library(plotly) # interactive graphs
library(paletteer) #more palettes
library(lessR) ##easy donuts 

#CONFIG
options(readr.show_col_types = FALSE) #don't show coltypes on read_csv
n_blocks = 6

## IMPORTANT 
graph_render = TRUE #set to true to generate all the SD graphs and save to folders 

```

*This notebook contains code to characterize the distribution of variables in the VIBES project Study 2. It relies upon data wrangling performed in `1_VIBES_S2_wrangling.Rmd`*.

In VIBES Study 2, participants completed an attitutde eliciation survey, asking questions about their attitude toward (5) stimulus images (data visualizations). Each participant was randomly assigned to one of 6 stimulus blocks, each containing 1 image from each of (4) categories (ranging from most abstract to most figural). Each participant started by responding to questions for a single 'common block' stimulus (that is thus super-powered as it was seen by all participants).  Two participant recruitment pools were used: Prolific, with a smaller set of participants recruited from Tumblr (to replicate results of interview Study 1 with participants sourced from Tumblr). 

# SETUP

_We start by importing data files previously wrangled in  `1_VIBES_S2_wrangling.Rmd`._


### IMPORT Configuration Files
```{r import-refs, message=FALSE, warning = FALSE}

############## IMPORT REFERENCE FILES
ref_stimuli <- readRDS("data/input/REFERENCE/ref_stimuli.rds")
ref_surveys <- readRDS("data/input/REFERENCE/ref_surveys.rds")
```

### IMPORT Data Files
```{r import-refs, message=FALSE, warning = FALSE}

############## IMPORT REFERENCE FILES
df_data <- readRDS("data/output/df_data.rds")
df_participants <- readRDS("data/output/df_participants.rds")
df_questions <- readRDS("data/output/df_questions.rds")
df_sd_questions_wide <- readRDS("data/output/df_sd_questions_wide.rds")
df_sd_questions_long <- readRDS("data/output/df_sd_questions_long.rds")
df_tools <- readRDS("data/output/df_tools.rds")
df_actions <- readRDS("data/output/df_actions.rds")
df_graphs_full <- readRDS("data/output/df_graphs_full.rds")
df_graphs <- readRDS("data/output/df_graphs.rds")

```

### SETUP Graph Labels
```{r setup-labels}

############## BUILD LABELS
ref_stim_id <- levels(ref_stimuli$ID)
ref_cat_questions <- c("MAKER_ID","MAKER_AGE","MAKER_GENDER")
ref_free_response <- c("MAKER_DETAIL", "MAKER_EXPLAIN", "TOOL_DETAIL", "CHART_EXPLAIN")
ref_conf_questions <- c("MAKER_CONF", "AGE_CONF", "GENDER_CONF", "TOOL_CONF")
ref_sd_questions <- c("MAKER_DESIGN","MAKER_DATA","MAKER_POLITIC",
               "MAKER_ARGUE","MAKER_SELF","MAKER_ALIGN","MAKER_TRUST",
               "CHART_LIKE", "CHART_BEAUTY", "CHART_INTENT", "CHART_TRUST")
left <- c("professional","professional","left-leaning","confrontational",
          "altruistic","does NOT share","untrustworthy",
          "NOT at all","NOT at all", "inform", "untrustworthy")
right <- c("layperson","layperson","right-leaning","diplomatic",
           "selfish", "DOES share", "trustworthy",
           "very much", "very much", "persuade", "trusthworthy")
ref_labels <- as.data.frame(cbind(left,right))
rownames(ref_labels) <- ref_sd_questions
# ref_blocks <- c("block1", "block2", "block3", "block4", "block5", "block6")
ref_blocks <- c(1,2,3,4,5,6)
rm(left,right)

```

### SETUP Colour Palettes
```{r setup-pallettes}

#https://www.r-bloggers.com/2022/06/custom-colour-palettes-for-ggplot2/

## list of color pallettes
my_colors = list(
  politics = c("#184aff","#5238bf", "#4f4a52" ,"#84649c", "#ff0000")
)



## function for using palettes
my_palettes = function(name, n, all_palettes = my_colors, type = c("discrete")) {
  palette = all_palettes[[name]]
  if (missing(n)) {
    n = length(palette)
  }
  type = match.arg(type)
  out = switch(type,
               continuous = grDevices::colorRampPalette(palette)(n),
               discrete = palette[1:n]
  )
  structure(out, name = name, class = "palette")
}

```


## GRAPHING Functions

```{r SD-GRAPHING-FUNCTIONS}


############## RETURNS SD STACKED AND COLORED BY BY X
## LOOP STYLE
multi_sd <- function (df, left, right, x, y, color) {

  # g <- ggplot(df, aes(y = .data[[x]], x = {{y}}, color = {{color}}))+
  g <- ggplot(df, aes(y = .data[[x]], x = .data[[y]], color = .data[[color]]))+
  geom_boxplot(width = 0.5) +
  geom_jitter(width = 0.1, alpha=0.5) +
    
  scale_y_continuous(limits=c(-1,101)) +
  labs(x="", y="") +
  coord_flip() +
  guides(
    y = guide_axis_manual(labels = left),
    y.sec = guide_axis_manual(labels = right)
  ) + theme_minimal()

  return(g)
}


############## RETURNS SINGLE SD 
## LOOP STYLE
single_sd <- function (df, left, right, x) {

  g <- ggplot(df, aes(y = {{x}}, x = ""))+
  geom_boxplot(width = 0.5) +
  geom_jitter(width = 0.1, alpha=0.5) +
  scale_y_continuous(limits=c(-1,101)) +
  labs(x="", y="") +
  coord_flip() +
  guides(
    y = guide_axis_manual(labels = left),
    y.sec = guide_axis_manual(labels = right)
  ) + theme_minimal()

  return(g)
}



######## RETURNS SINGLE SD
##  APPLY STYLE
# plot_sd = function (data, column, type, split, boxplot) {
# 
#   ggplot(df, aes(y = .data[[column]], x="")) +
#     {if(boxplot) geom_boxplot(width = 0.5) } +
#     geom_jitter(width = 0.1, alpha=0.3, {if(split) aes(color=Distribution)}) +
#     {if(split) facet_grid(Distribution ~ .)} +
#     scale_y_continuous(limits=c(-1,101)) +
#     labs(x="", y="") +
#     coord_flip()  +
#     {if(type == "S")
#       guides(
#         y = guide_axis_manual(labels = ref_labels[column,"left"]),
#         y.sec = guide_axis_manual(labels = ref_labels[column,"right"])
#       )} +
#     {if(type == "Q")
#       guides(
#         y = guide_axis_manual(labels = ref_labels[q,"left"]),
#         y.sec = guide_axis_manual(labels = ref_labels[q,"right"])
#       )} +
#   theme_minimal()  +
#      labs (
#        caption = column
#      )
# }

######## RETURNS SINGLE SD
##  APPLY STYLE
plot_sd = function (data, column, type, facet, facet_by, boxplot) {

  ggplot(df, aes(y = .data[[column]], x="")) +
    {if(boxplot) geom_boxplot(width = 0.5) } +
    geom_jitter(width = 0.1, alpha=0.3, {if(facet) aes(color=.data[[facet_by]])}) +
    {if(facet) facet_grid(.data[[facet_by]] ~ .)} +
    scale_y_continuous(limits=c(-1,101)) +
    labs(x="", y="") +
    coord_flip()  +
    {if(type == "S")
      guides(
        y = guide_axis_manual(labels = ref_labels[column,"left"]),
        y.sec = guide_axis_manual(labels = ref_labels[column,"right"])
      )} +
    {if(type == "Q")
      guides(
        y = guide_axis_manual(labels = ref_labels[q,"left"]),
        y.sec = guide_axis_manual(labels = ref_labels[q,"right"])
      )} +
  theme_minimal()  +
     labs (
       caption = column
     ) + easy_remove_legend()
}

```

## TODO Wrangle Participant Confidence 
```{r wrangle-confidence}

# 
# ## CALCULATE AV CONFIDENCE FOR EACH SEMANTIC DIFFERENTIALS 
# df_sds <- df_sd_questions_long %>% 
#   group_by(PID, QUESTION) %>% 
#   summarize(
#     mean = mean(value), 
#     sd = sd (value)
#   ) 
# 
# df_sds_WIDE <- df_sds %>% 
#     pivot_wider(
#       names_from = QUESTION,
#       values_from = c(mean, sd)
#   )
# 
# ## CALCULATE AV CONFIDENCE ACROSS SEMANTIC DIFFERENTIALS 
# df_grandsds <- df_sd_questions_long %>% 
#   group_by(PID) %>% 
#   summarize(
#     SDIFF_mean = mean(value), 
#     SDIFF_sd = sd(value)
#   ) 
# 
# 
# df_grandsds_LONG <- df_grandsds %>% 
#   mutate(
#       QUESTION = "SDIFF", 
#       mean = SDIFF_mean, 
#       sd = SDIFF_sd
# ) %>% select(-SDIFF_mean, -SDIFF_sd)
#   
# 
# 
# ## CALCULATE AV CONFIDENCE FOR EACH CONFIDENCE
# df_confq <- df_questions %>% 
#   filter(QUESTION %in% ref_conf_questions)%>% 
#   group_by(PID, QUESTION) %>% 
#   summarize(
#     mean = mean(as.numeric(value)), 
#     sd = sd (as.numeric(value))
#   ) 
# 
# df_confq_WIDE <- df_confq %>% 
#     pivot_wider(
#       names_from = QUESTION,
#       values_from = c(mean, sd)
#   )
# 
# ## CALCULATE AV CONFIDENCE ACROSS SEMANTIC DIFFERENTIALS 
# df_grandconfs <- df_questions %>% 
#   filter(QUESTION %in% ref_conf_questions)%>% 
#   group_by(PID) %>% 
#   summarize(
#     CONF_mean = mean(as.numeric(value)), 
#     CONF_sd = sd(as.numeric(value))
#   )
# 
# 
# df_grandconfs_LONG <- df_grandconfs %>% 
#   mutate(
#       QUESTION = "CONF", 
#       mean = CONF_mean, 
#       sd = CONF_sd
# ) %>% select(-CONF_mean, -CONF_sd) 
#   
# 
# 
# 
# ## JOIN TOGETHER WIDE
# df_confidence_wide <- left_join(df_sds_WIDE, df_confq_WIDE, by="PID")
# df_confidence_wide <- left_join(df_confidence_wide, df_grandsds, by = "PID")
# df_confidence_wide <- left_join(df_confidence_wide, df_grandconfs, by = "PID")
# df_confidence_wide <- left_join(df_confidence_wide, df_participants, by = "PID")
# 
# 
# ##JOIN TOGETHER LONG
# df_confidence_long <- rbind(df_sds, df_confq, df_grandsds_LONG, df_grandconfs_LONG) %>% 
#   mutate(
#     QUESTION = factor(QUESTION)
#   ) 
# 
# df_confidence_long <- left_join(df_confidence_long, df_participants, by="PID")
# 
# rm(df_sds, df_grandsds, df_confq, df_grandconfs, df_sds_WIDE, df_grandsds_LONG, df_confq_WIDE, df_grandconfs_LONG)
# 
# print("df_confidence_wide is a participant level dataset with by question and question type mean and df per participant")
# print("df_confidence_long is a participant level dataset with by question and question type mean and df per participant")
# print("In both cases the means are over all 5 stimuli seen by each participant")

```




# DEMOGRAPHICS


### Sample Size

```{r}

df <- df_participants

title = "Number of participants by distribution and stimulus block"
cols = c("Sampling Platform", "Block-1","Block-2","Block-3","Block-4","Block-5","Block-6", "Sum")
cont <- table(df$Distribution, df$Assigned.Block)
cont %>% addmargins() %>% kbl(caption = title, col.names = cols) %>%  kable_classic()

# qacBase::crosstab(df, Distribution, Assigned.Block)

```




### Age

_As expected, the (smaller) sample of participants recruited from Tumblr skewed toward younger ages than the broader Prolific sample. This was expected based on the known demographic characteriztion of Tumblr users.  Most importantly, across both samples, the relative distribution of age groups was comparable across stimulus blocks._

```{r demo-age, message=FALSE, warning=FALSE}

#SET DATAFRAME
df = df_data

# AGE by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = D_age, fill = Distribution)) +
  geom_bar() + 
  # scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant AGE by SAMPLE", 
    caption = "", 
    y = "AGE",
    x = "(count)",
    fill = "SAMPLE") +
  theme_minimal() 

# AGE by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = Distribution, fill = fct_rev(D_age) )) +
  geom_bar(position = "stack") +
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant AGE by SAMPLE", 
    caption = "", 
    x = "(count)",
    y = "SAMPLE",
    fill = "AGE") +
  theme_minimal() 

# VERTICAL FACET BAR CHART 
# AGE by SAMPLE and BLOCK
ggplot(data = df, aes( x = Assigned.Block, fill = fct_rev(D_age) )) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant AGE by SAMPLE and BLOCK", 
    caption = "As expected, similar distribution within SAMPLE across BLOCKS", 
    x = "Stimulus Block",
    fill = "Age") +
  theme_minimal() 

```

### Gender (detail)

```{r demo-gender, message=FALSE}
 
#SET DATAFRAME
df = df_data

# GENDER by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = D_gender, fill = Distribution)) +
  geom_bar(position="stack") + 
  # scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant GENDER by SAMPLE", 
    caption = "", 
    y = "GENDER",
    x = "(count)",
    fill = "SAMPLE") +
  theme_minimal() 

# GENDER by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = Distribution, fill = fct_rev(D_gender) )) +
  geom_bar(position = "stack") +
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant GENDER by SAMPLE", 
    caption = "", 
    x = "(count)",
    y = "SAMPLE",
    fill = "GENDER") +
  theme_minimal() 

# GENDER by SAMPLE and BLOCK
# VERTICAL FACET BAR CHART
ggplot(data = df, aes( x = Assigned.Block, fill = fct_rev(D_gender) )) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( title = "Participant GENDER by SAMPLE and BLOCK", 
        caption = "As expected, similiar distributions within SAMPLE across BLOCKS", 
        x = "Stimulus Block", fill = "GENDER") +
  theme_minimal() 
```

### Gender (collapsed)
```{r gender-collapsed, message = FALSE}

df <- df_data

# GENDER (collapsed) by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = D_gender_collapsed, fill = Distribution)) +
  geom_bar(position="stack") + 
  # scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant GENDER by SAMPLE", 
    caption = "", 
    y = "GENDER (collapsed)",
    x = "(count)",
    fill = "SAMPLE") +
  theme_minimal() 

# GENDER (collapsed) by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = Distribution, fill = fct_rev(D_gender_collapsed) )) +
  geom_bar(position = "stack") +
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant GENDER by SAMPLE", 
    caption = "", 
    x = "(count)",
    y = "SAMPLE",
    fill = "GENDER (collapsed)") +
  theme_minimal() 


# GENDER (collapsed) by SAMPLE and BLOCK
# VERTICAL FACET BAR CHART
ggplot(data = df, aes( x = Assigned.Block, fill = fct_rev(D_gender_collapsed) )) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( title = "GENDER (collapsed) by SAMPLE and BLOCK", 
        caption = "As expected, similiar distributions within SAMPLE across BLOCKS", 
        x = "Stimulus Block", fill = "GENDER (collapsed)") +
  theme_minimal() 


``` 

### Gender (described)

```{r describe-gender}

### DESCRIBE GENDER FREE REPONSE TEXT

#TABLE of Free Response Demographic Gender
title = "Participant Gender — Self Describe"
cols = c("Text","PROLIFIC","TUMBLR","TOTAL")
cont <- table(df$D_gender_4_TEXT, df$Distribution)
cont %>% addmargins() %>% kbl(caption = title, col.names = cols) %>%  kable_classic()


## FOR DESCRIPTIVES PARAGRAPH
# #PROLIFIC
df.p <- df_data %>% filter(Distribution == "PROLIFIC")
desc.gender.p <- table(df.p$D_gender) %>% prop.table()
names(desc.gender.p) <- levels(df.p$D_gender)
p_participants <- nrow(df.p)

# #TUMBLR
df.t <- df_data %>% filter(Distribution == "TUMBLR")
desc.gender.t <- table(df.t$D_gender) %>% prop.table()
names(desc.gender.t) <- levels(df.t$D_gender)
t_participants <- nrow(df.t)


```


`r p_participants` individuals from Prolific participated in Study 2, ( `r round(desc.gender.p[["Female"]],2)*100`% Female, `r round(desc.gender.p[["Male"]],2)*100`% Male, `r round(desc.gender.p[["Non-binary / third gender"]],2)*100`% Non-binary, `r (round((desc.gender.p[["Prefer not to say"]] + desc.gender.p[["Prefer to self-describe"]]),2)) * 100`% Other).


Note that a higher proportion of participants recruited from Tumblr represent identities other than cis-gender Female and cis-gender Male.   `r t_participants` individuals from Tumblr participated in Study 2, ( `r round(desc.gender.t[["Female"]],2)*100`% Female, `r round(desc.gender.t[["Male"]],2)*100`% Male, `r round(desc.gender.t[["Non-binary / third gender"]],2)*100`% Non-binary, `r (round((desc.gender.t[["Prefer not to say"]] + desc.gender.t[["Prefer to self-describe"]]),2)) * 100`% Other).



### Education (detail)
```{r demo-education, message=FALSE}

df <- df_data

# EDUCATION by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = D_education, fill = Distribution)) +
  geom_bar(position="stack") + 
  # scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant EDUCATION by SAMPLE", 
    caption = "", 
    y = "EDUCATION",
    x = "(count)",
    fill = "SAMPLE") +
  theme_minimal() 

# EDUCATION by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = Distribution, fill = fct_rev(D_education) )) +
  geom_bar(position = "stack") +
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant EDUCATION by SAMPLE", 
    caption = "", 
    x = "(count)",
    y = "SAMPLE",
    fill = "EDUCATION") +
  theme_minimal() 

# EDUCATION by SAMPLE and BLOCK
# VERTICAL FACET BAR CHART
ggplot(data = df, aes( x = Assigned.Block, fill = fct_rev(D_education) )) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .)+
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( x = "Stimulus Block", fill = "EDUCATION",
        title = "Participant EDUCATION by SAMPLE and BLOCK",
        caption = "similiar distributions of education across blocks within samples") +
  theme_minimal() 
```
### Education (collapsed)
```{r education-collapsed, message=FALSE}

df <- df_data

# EDUCATION (collapsed) by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = D_education_collapsed, fill = Distribution)) +
  geom_bar(position="stack") + 
  # scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant EDUCATION (collapsed)  by SAMPLE", 
    caption = "", 
    y = "EDUCATION (collapsed)",
    x = "(count)",
    fill = "SAMPLE") +
  theme_minimal() 

# EDUCATION (collapsed) by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = Distribution, fill = fct_rev(D_education_collapsed) )) +
  geom_bar(position = "stack") +
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( 
    title = "Participant EDUCATION (collapsed) by SAMPLE", 
    caption = "", 
    x = "(count)",
    y = "SAMPLE",
    fill = "EDUCATION (collapsed)") +
  theme_minimal() 



# VERTICAL FACET BAR CHART
# COLLAPSED EDUCATION by SAMPLE and BLOCK
ggplot(data = df, aes( x = Assigned.Block, fill = fct_rev(D_education_collapsed) )) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .)+
  scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) + 
  labs( x = "Stimulus Block", fill = "EDUCATION",
        title = "Participant EDUCATION (collapsed) by SAMPLE and BLOCK",
        caption = "similiar distributions of education across blocks within samples") +
  theme_minimal() 

```

### Politcal Affiliation


```{r demo-political-party}

df <- df_data %>% mutate(politicalParty = fct_rev(D_politicalParty))


# EDUCATION by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = politicalParty, fill = Distribution)) +
  geom_bar(position="stack") + 
  labs( 
    title = "Political AFFILIATION by SAMPLE", 
    caption = "", 
    y = "EDUCATION",
    x = "(count)",
    fill = "SAMPLE") +
  theme_minimal() 

# EDUCATION by SAMPLE 
# HORIZONTAL STACKED BAR 
ggplot(data = df, aes( y = Distribution, fill = fct_rev(politicalParty) )) +
  geom_bar(position = "stack") +
  scale_fill_manual(values = my_palettes(name="politics", type = "discrete")) +
  labs( 
    title = "Political AFFILIATION by SAMPLE", 
    caption = "", 
    x = "(count)",
    y = "SAMPLE",
    fill = "EDUCATION") +
  theme_minimal() 

# POLITICAL Affiliation by SAMPLE and BLOCK
# VERTICAL FACET BAR CHART 
ggplot(data = df_data, aes( fill = D_politicalParty, x = Assigned.Block )) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .) + 
  scale_fill_manual(values = my_palettes(name="politics", type = "discrete")) +
  labs( title = "Political AFFILIATION by SAMPLE and BLOCK",
        caption = "Similar distribution across BLOCKS within SAMPLES", x = "Stimulus Block") +
  theme_minimal() +
  easy_add_legend_title("")

```



### Political Values — Fiscal 

```{r, demo-political-fiscal, warning=FALSE}

df <- df_data

# FISCAL POLITICAL by SAMPLE

leftside <- rep("left-leaning", nlevels(df$Distribution))
rightside <- rep("right-leaning", nlevels(df$Distribution))
g <- ggplot(df, aes(x=fct_rev(Distribution), y=D_politicsFiscal, color=Distribution)) +
  geom_boxplot(position=position_dodge(0.9), width = 0.5)+
  geom_jitter(position=position_jitterdodge(), alpha = 0.3) +
  labs( title = "FISCAL VALUES by SAMPLE",
        caption = "As expected, the smaller Tumblr sample is more left-leaning than the Prolific sample",
         y = "Fiscal Politics", x = "", color = "Sample") +
  theme_minimal() +
  coord_flip()
g + guides(
  y = guide_axis_manual(
  breaks = c("PROLIFIC","TUMBLR"),
  labels = leftside
  ),
  y.sec = guide_axis_manual(
  breaks = c("PROLIFIC","TUMBLR"),
  labels = rightside
))


# FISCAL POLITICAL SAMPLE and BLOCK

leftside <- rep("left-leaning", length(ref_blocks))
rightside <- rep("right-leaning", length(ref_blocks))
g <- ggplot(df, aes(x=fct_rev(Assigned.Block), y=D_politicsFiscal, color=Assigned.Block)) +
  geom_boxplot(position=position_dodge(0.9), width = 0.5)+
  geom_jitter(position=position_jitterdodge(), alpha = 0.3) +
  facet_grid(Distribution ~ .)+
  labs( title = "FISCAL VALUES by SAMPLE and Stimulus BLOCK",
        caption = "similar distributions across BLOCKS within SAMPLE",
         y = "Fiscal Politics ", x = "", color = "Block") +
  theme_minimal() +
  coord_flip()
g + guides(
  y = guide_axis_manual(
  breaks = ref_blocks,
  labels = leftside
  ),
  y.sec = guide_axis_manual(
  breaks = ref_blocks,
  labels = rightside
))

rm(g)

```
### Political Values — Social 


```{r, demo-political-social, warning=FALSE}

df <- df_data

# SOCIAL POLITICAL by SAMPLE

leftside <- rep("left-leaning", nlevels(df$Distribution))
rightside <- rep("right-leaning", nlevels(df$Distribution))
g <- ggplot(df, aes(x=fct_rev(Distribution), y=D_politicsSocial, color=Distribution)) +
  geom_boxplot(position=position_dodge(0.9), width = 0.5)+
  geom_jitter(position=position_jitterdodge(), alpha = 0.3) +
  labs( title = "SOCIAL VALUES by SAMPLE",
        caption = "As expected, the smaller Tumblr sample is more left-leaning than the Prolific sample",
         y = "Fiscal Politics", x = "", color = "Sample") +
  theme_minimal() +
  coord_flip()
g + guides(
  y = guide_axis_manual(
  breaks = c("PROLIFIC","TUMBLR"),
  labels = leftside
  ),
  y.sec = guide_axis_manual(
  breaks = c("PROLIFIC","TUMBLR"),
  labels = rightside
))

# SOCIAL POLITICAL SAMPLE

leftside <- rep("left-leaning", length(ref_blocks))
rightside <- rep("right-leaning", length(ref_blocks))
g <- ggplot(df, aes(x=fct_rev(Assigned.Block), y=D_politicsSocial, color=Assigned.Block)) +
  geom_boxplot(position=position_dodge(0.9), width = 0.5)+
  geom_jitter(position=position_jitterdodge(), alpha = 0.3) +
  facet_grid(Distribution ~ .)+
  labs( title = "SOCIAL VALUES by SAMPLE and BLOCK",
        subtitle = "(expect similar values across samples)",
         y = "Social Politics", x = "", color = "Block") +
  theme_minimal() +
  coord_flip()
g + guides(
  y = guide_axis_manual(
  breaks = ref_blocks,
  labels = leftside
  ),
  y.sec = guide_axis_manual(
  breaks = ref_blocks,
  labels = rightside
))


rm(g)

```

### Political Values — Description
```{r describe-politics}

r_politics <- nrow(df_data %>% filter(D_politicsSocial >= 50)) / nrow(df_data)
l_politics <- nrow(df_data %>% filter(D_politicsSocial < 50)) / nrow(df_data)
r_fiscal <- nrow(df_data %>% filter(D_politicsFiscal >= 50)) / nrow(df_data)
l_fiscal <- nrow(df_data %>% filter(D_politicsFiscal < 50)) / nrow(df_data)
 

#PROLIFIC
df.p <- df_data %>% filter(Distribution == "PROLIFIC")
desc.fiscal.p <- psych::describe(df.p$D_politicsFiscal)
desc.social.p <- psych::describe(df.p$D_politicsSocial)


#TUMBLR
df.t <- df_data %>% filter(Distribution == "TUMBLR")
desc.fiscal.t <- psych::describe(df.t$D_politicsFiscal)
desc.social.t <- psych::describe(df.t$D_politicsSocial)

  
```


For the `r nrow(df.p)` participants recruited from Prolific, a spectrum of Social Political values [ranging from 0 (left-leaning) to 100 (right-leaning)] ranged from `r desc.social.p$min` to `r desc.social.p$max`, with a mean value of `r round(desc.social.p$mean,2)`, SD = `r (round(desc.social.p$sd,2))`.  A spectrum of Fiscal Political values [ranging from 0 (left-leaning) to 100 (right-leaning)] ranged from `r desc.fiscal.p$min` to `r desc.fiscal.p$max`, with a mean value of `r round(desc.fiscal.p$mean,2)`, SD = `r (round(desc.fiscal.p$sd,2))`.   

For the `r nrow(df.t)` participants recruited from Tumblr, a spectrum of Social Political values [ranging from 0 (left-leaning) to 100 (right-leaning)] ranged from `r desc.social.t$min` to `r desc.social.t$max`, with a mean value of `r round(desc.social.t$mean,2)`, SD = `r (round(desc.social.t$sd,2))`.  A spectrum of Fiscal Political values [ranging from 0 (left-leaning) to 100 (right-leaning)] ranged from `r desc.fiscal.t$min` to `r desc.fiscal.t$max`, with a mean value of `r round(desc.fiscal.t$mean,2)`, SD = `r (round(desc.fiscal.t$sd,2))`.   

Overall, `r round(l_politics*100,2)`% of respondents identify with left-leaning social values (vs) `r round(r_politics*100,2)`% identifying as right-leaning; while `r round(l_fiscal*100,2)`% of respondents reported left-leaning fiscal values (vs) `r round(r_fiscal*100,2)`% identify as right-leaning. 




# INTERESTING QS 

### Political Values X  Political Affiliations

```{r demo-plot-political-grid,  fig.width = 10}

df <- df_graphs %>% select(PID, Assigned.Block, Distribution, D_politicsSocial, D_politicsFiscal, D_politicalParty) %>% 
  mutate(
    d_social = D_politicsSocial,
    d_fiscal = D_politicsFiscal
  )

ggplot(df, aes(x = d_social, y = d_fiscal, color = D_politicalParty)) + 
  geom_point() + 
  geom_hline(yintercept = 50) +
  geom_vline(xintercept = 50) + 
  facet_grid(Distribution~D_politicalParty)+
  labs(
    title = "Social and Fiscal Political Values by Political Party Affiliation",
    x = "Social Values", y = "Fiscal Values"
  )+
  theme_minimal() + 
  easy_remove_legend() 



```

### Platform Choice X SAMPLE and AGE

```{r platform-age}

df <- df_data

#PLATFORM CHOICE by Age
## FACETED STACKED BAR CHART 
ggplot( df, aes( x = D_age, fill = PLATFORM)) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .) + 
  labs( title = "PLATFORM CHOICE by SAMPLE and AGE",
        caption = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") + 
  easy_add_legend_title("") +
  theme_minimal()


# qacBase::crosstab(df, D_age,PLATFORM, plot=TRUE) 


```


## Education X Income
```{r education-income, message=FALSE}
df <- df_data

#Education by Income
## FACETED STACKED BAR CHART 
ggplot( df, aes( x = D_education_collapsed, fill = D_income)) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .) + 
  labs( title = "Education (collapsed) by SAMPLE and INCOME",
        caption = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") + 
  easy_add_legend_title("") +
  theme_minimal()
```


## TODO Maker Gender X Participant Gender



# RESPONSE PROFILE

## Platform Choice

_At the start of the study, participants were asked to choose one of five social media platforms to serve as the situational context for the questions they would be asked. (ie. Imagine you are scrolling through your [platform] feed)_. 

```{r platform-choice}

df <- df_data

#PLATFORM CHOICE
## FACETED STACKED BAR CHART 
ggplot( df, aes( x = Assigned.Block, fill = PLATFORM)) +
  geom_bar(position = "stack") +
  facet_grid(Distribution ~ .) + 
  labs( title = "PLATFORM CHOICE by SAMPLE and BLOCK",
        caption = "Most Tumblrs chose Tumblr", x = "Stimulus Block") +
  scale_fill_viridis(discrete=TRUE, option="viridis") + 
  easy_add_legend_title("") +
  theme_minimal()




```




## Response Time
```{r demo-response-time}

df <- df_data

## BOXPLOT — SURVEY RESPONSE TIME 
ggplot(df_data, aes(x=fct_rev(Assigned.Block), y=duration.min, color=Assigned.Block))+
  geom_boxplot(position=position_dodge(0.9))+
  geom_jitter(position=position_jitterdodge(), alpha = 0.3) +
  facet_grid(Distribution ~.) + 
  coord_flip() + 
  labs( y = "Survey Response Time (mins)", x="",
        title = "TOTAL Response Time by SAMPLE and BLOCK",
        caption = "distributions similar across both SAMPLES and stimulus BLOCKS [1-6]") +
  theme_minimal() + theme(legend.position = "none") 

## RIDGEPLOT — SURVEY RESPONSE TIME 
ggplot(df, aes(x = duration.min, y = fct_rev(Assigned.Block), fill = fct_rev(Assigned.Block))) +
  geom_density_ridges(scale=0.8) +
  # geom_boxplot()+
  stat_pointinterval()+
  theme_ridges() +
  scale_fill_discrete(direction=-1)+
  facet_grid(Distribution ~.) + 
  theme_minimal() + 
  theme(legend.position = "none") +
    labs( x = "Survey Response Time (mins)", y="",
        title = "TOTAL Response Time by Sample",
        caption = "distributions similar across SAMPLES and stimulus BLOCKS[1-6]") 



p.desc.duration <- psych::describe(df_data %>% filter(Distribution=="PROLIFIC") %>% pull(duration.min))
t.desc.duration <- psych::describe(df_data %>% filter(Distribution=="TUMBLR") %>% pull(duration.min))

``` 


PROLIFIC SAMPLE (n = `r p.desc.duration$n` ) participant response times ranged from `r p.desc.duration$min` to `r p.desc.duration$max` minutes, with a mean response time of `r round(p.desc.duration$mean,2)` minutes, SD = `r (round(p.desc.duration$sd,2))`.

TUMBLR SAMPLE (n = `r t.desc.duration$n` ) participant response times ranged from `r t.desc.duration$min` to `r t.desc.duration$max` minutes, with a mean response time of `r round(t.desc.duration$mean,2)` minutes, SD = `r (round(t.desc.duration$sd,2))`.

# WIP Confidence

How confident are participants in their attributions? We want to explore this from several perspectives, including: participant-level differences, question-level differences, and stimulus-level differences

#### Distribution of Confidence

```{r inspect-confidence, message=FALSE}

df <- df_questions %>%
  filter(QUESTION %in% ref_conf_questions) %>% 
  mutate(value= as.numeric(value)) %>% 
  select(QUESTION, value, STIMULUS, STIMULUS_CATEGORY, BLOCK)


## CONFIDENCE by QUESTION
(g <- ggplot(df, aes(x = value, fill = QUESTION)) + 
  geom_histogram() + 
  facet_wrap(. ~ QUESTION) +  #, scales = "free", space = "free", drop = TRUE
  theme_minimal() + 
  labs(title = "Distrubtion of Confidence by QUESTION") + 
  easy_remove_legend())

ggsave(plot = g, path="figs/histograms", filename =paste0("confidence_by_question_","histograms.png"), units = c("in"))


## CONFIDENCE by QUESTION and STIMULUS

(g <- ggplot(df, aes(x = value, fill = QUESTION)) + 
  geom_histogram() + 
  facet_grid(STIMULUS ~ QUESTION) +  #, scales = "free", space = "free", drop = TRUE
  theme_minimal() + 
  labs(title = "Distrubtion of Confidence by QUESTION and STIMULUS") + 
  easy_remove_legend())

ggsave(plot = g, path="figs/histograms", filename =paste0("confidence_by_question_stimulus_","histograms.png"), units = c("in"), width = 20, height = 30)


```


```{r demo-scales}

## QUESTION LEVEL CONFIDENCE 
df <- df_questions %>%
  filter(QUESTION %in% ref_sd_questions) %>% 
  mutate(value= as.numeric(value)) %>% 
  select(QUESTION, value, STIMULUS)


(g <- ggplot(df, aes(x = value, fill = QUESTION)) + 
  geom_histogram() + 
  facet_grid( STIMULUS ~ QUESTION) + 
  theme_minimal() + 
  labs(title = "Distrubtion of SEMANTIC DIFFERENTIAL SCALES by Question") + 
  easy_remove_legend())



ggsave(plot = g, path="figs/histograms", filename =paste0("sd_scales_by_question_stimulus","histograms.png"), units = c("in"), width = 20, height = 30)

```

```{r demo-scales-category}

## QUESTION LEVEL CONFIDENCE 
df <- df_questions %>%
  filter(QUESTION %in% ref_sd_questions) %>% 
  mutate(value= as.numeric(value))


(g <- ggplot(df, aes(x = value, fill = STIMULUS_CATEGORY)) + 
  geom_histogram() + 
  facet_grid( STIMULUS_CATEGORY~ QUESTION) + 
  theme_minimal() + 
  labs(title = "Distrubtion of SEMANTIC DIFFERENTIAL SCALES by Question") + 
  easy_remove_legend())

ggsave(plot = g, path="figs/histograms", filename =paste0("sd_scales_by_question_category","histograms.png"), units = c("in"), width = 20, height = 20)

```


```{r}

## STIMULUS LEVEL CONFIDENCE 

df <- df_questions %>%
  filter(QUESTION %in% ref_conf_questions) %>% 
  mutate(value= as.numeric(value)) 

(g <- ggplot(df, aes(x = value, fill = fct_rev(STIMULUS_CATEGORY))) + 
  geom_histogram() + 
  facet_grid(rows = vars(BLOCK),
             cols = vars(fct_rev(STIMULUS_CATEGORY)), scales = "free_y", space = "free", drop = TRUE) +
  theme_minimal()+  
  labs(title = "Distrubtion of Confidence by Stimulus"))

ggsave(plot = g, path="figs/histograms", filename =paste0("confidence_matrix_","histograms.png"), units = c("in"), width = 20, height = 20)
```


#### Individual Participant Confidence

```{r message=FALSE}

df <- df_questions %>%
  filter(QUESTION %in% c("MAKER_CONF", "AGE_CONF", "GENDER_CONF", "TOOL_CONF")) %>% 
  mutate(value= as.numeric(value)) %>% 
  group_by(PID, QUESTION) %>% 
  summarise(
    mean_conf = mean(value),
    sd_conf = sd(value),
    var_conf = var(value)
  )


ggplot(df, aes( x = mean_conf)) +
  geom_histogram() +
  facet_wrap( ~ QUESTION) + 
  labs(
    title = "Mean Participant confidence by Question",
    subtitle = "(averaging across all 5 stimuli per participant)"
  ) + 
  theme_minimal()
  
  
ggplot(df, aes( x = sd_conf)) +
  geom_histogram() +
  facet_wrap( ~ QUESTION) + 
  labs(
    title = "Standard Deviation of Participant confidence by Question",
    subtitle = "(averaging across all 5 stimuli per participant)"
  ) +
  theme_minimal()  
  
```
```{r message=FALSE, warning=FALSE}
## BY PARTICIPANT
df <- df_questions %>%
  filter(QUESTION %in% c("MAKER_CONF", "AGE_CONF", "GENDER_CONF", "TOOL_CONF")) %>% 
  mutate(value= as.numeric(value)) %>% 
  group_by(PID) %>% 
  summarise(
    mean_conf = mean(value),
    sd_conf = sd(value),
    var_conf = var(value)
  )

ggplot(df, aes( x = mean_conf)) +
  geom_histogram(binwidth = 2) +
  
  labs(
    title = "Mean Participant Confidence ",
    subtitle = "(averaging across 4 confidence questions and all 5 stimuli per participant)"
  ) +
  theme_minimal()  


ggplot(df, aes( x = sd_conf)) +
  geom_histogram(binwidth = 2) +
  xlim(0,100)+
  labs(
    title = "Standard Deviation of Participant Confidence ",
    subtitle = "(averaging across 4 confidence questions and all 5 stimuli per participant)"
  ) +
  theme_minimal()  

```

#### Predicting Confidence 

```{r predict-confidence}

df <- df_graphs %>% left_join(df_confidence_wide, by="PID") %>% 
  select(-contains(".y")) %>% 
  rename_with(
    stringr::str_replace, 
      pattern = ".x", replacement = ""
  )


## maker confidence by age
(m <- ggplot(df, aes( color = CONF_mean, x = D_age, y = MAKER_CONF, text = PID)) + 
  geom_jitter(size = 0.5, width = .2, height = 0) + 
  scale_colour_paletteer_c("ggthemes::Red-Black Diverging", direction = -1)+
  labs (
    title = "Confidence in MAKER_ID by Participant Age",
    subtitle = "color by average participant confidence: red HIGH, black LOW",
    x = "participant age"
  ) + theme_minimal() )


# ggplotly(m)

## age maker confidence by age
(a <- ggplot(df, aes( color = CONF_mean, x = D_age, y = AGE_CONF, text = PID)) + 
  geom_jitter(size = 0.5, width = .2, height = 0) + 
  scale_colour_paletteer_c("ggthemes::Red-Black Diverging", direction = -1)+
  labs (
    title = "Confidence in MAKER_AGE by Participant Age",
    subtitle = "color by average participant confidence: red HIGH, black LOW",
    x = "participant age"
  ) + theme_minimal() )


# ggplotly(a)

## age maker confidence by age
(a <- ggplot(df, aes( color = CONF_mean, x = D_age, y = GENDER_CONF, text = PID)) + 
  geom_jitter(size = 0.5, width = .2, height = 0) + 
  scale_colour_paletteer_c("ggthemes::Red-Black Diverging", direction = -1)+
  labs (
    title = "Confidence in MAKER_GENDER by Participant Age",
    subtitle = "color by average participant confidence: red HIGH, black LOW",
    x = "participant age"
  ) + theme_minimal() )


# ggplotly(a)

```



# ATTRIBUTIONS

## MAKER ID

### Maker ID by Stimulus

```{r maker-id-stimulus}

df <- df_graphs 

#MAKER IDENTIFICATION
ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_ID)) +
  geom_bar(position = "fill") +
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ Distribution, scales = "free", space = "free") + 
  labs( title = "MAKER ID by Stimulus (grouped by CATEGORY) ",
        subtitle = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  coord_flip()+
  easy_add_legend_title("") +
  theme_minimal()



#MAKER IDENTIFICATION
ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_ID)) +
  geom_bar(position = "fill") +
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ ., scales = "free", space = "free") + 
  labs( title = "MAKER ID by Stimulus (grouped by CATEGORY) ",
        subtitle = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  coord_flip()+
  easy_add_legend_title("") +
  theme_minimal()

```

### Maker ID by Category

```{r maker-id-category}

df <- df_graphs 

#MAKER IDENTIFICATION
ggplot( df, aes( x = STIMULUS_CATEGORY, fill = MAKER_ID)) +
  geom_bar(position = "fill") +
  facet_grid(Distribution ~ .) + 
  labs( title = "MAKER ID by Stimulus Category",
        subtitle = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  coord_flip()+
  easy_add_legend_title("") +
  theme_minimal()

#MAKER IDENTIFICATION
ggplot( df, aes( x = STIMULUS_CATEGORY, fill = MAKER_ID)) +
  geom_bar(position = "fill") +
  labs( title = "MAKER ID by Stimulus Category",
        subtitle = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  coord_flip()+
  easy_add_legend_title("") +
  theme_minimal()

```




### Maker ID & Confidence by Stimulus


```{r maker-id-confidence-stimulus, fig.width = 10}

#FILTER DATAFRAME
df <- df_graphs 

######### MAKER ID AND CONFIDENCE ##############
# MAKER_ID by Sample and BEHAVIOR 
a <- ggplot (df, aes( x = fct_rev(STIMULUS), fill = MAKER_ID)) + 
  # geom_bar(width = 0.5, position = position_dodge(0.5)) +
  geom_bar(position = "fill", width = 0.8) + 
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  # facet_grid( df$ENCOUNTER) + 
  labs (x = "") + 
  theme_minimal() 

# MAKER_CONFIDENCE by IDENTIFICATION  
b <- ggplot(df, aes( x = fct_rev(STIMULUS), y = MAKER_CONF, color = MAKER_ID)) + 
  geom_boxplot(position=position_dodge(0.9), width = 0.5)+
  geom_jitter(position=position_jitterdodge(), alpha = 0.4) +
  scale_color_viridis(discrete=TRUE, option="viridis") +
  labs (title = "") +
  labs (x = "") + 
  theme_minimal() 

(p <- (a / b )  + plot_annotation(
  title = 'MAKER ID & CONFIDENCE by Stimulus',
  subtitle = '',
  caption = ''))

###################################################
rm(a,b,p)
```


### Maker ID & Confidence

```{r, maker-id-confidence-category, message=FALSE, warning=FALSE}

#FILTER DATAFRAME
df <- df_graphs 

######### MAKER ID AND CONFIDENCE ##############
# MAKER_ID by Sample and BEHAVIOR 
a <- ggplot (df, aes( x = fct_rev(STIMULUS_CATEGORY), fill = MAKER_ID)) + 
  geom_bar(position = "fill") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  # facet_grid( df$ENCOUNTER) + 
  labs (x = "") + 
  theme_minimal() 

# MAKER_CONFIDENCE by IDENTIFICATION  
b <- ggplot(df, aes( x = fct_rev(STIMULUS_CATEGORY), y = MAKER_CONF, color = MAKER_ID)) + 
  geom_boxplot(position=position_dodge(0.9))+
  geom_jitter(position=position_jitterdodge(), alpha = 0.2) + 
  scale_color_viridis(discrete=TRUE, option="viridis") +
  # labs (title = "MAKER-ID-CONFIDENCE") +
  labs (x = "STIMULUS CATEGORY") + 
  theme_minimal() 

(p <- (a / b )  + plot_annotation(
  title = 'MAKER ID & CONFIDENCE',
  subtitle = '',
  caption = ''))

rm(a,b,p)

###################################################
```






## MAKER AGE

### Maker Age by Stimulus

```{r maker-age-stimulus}

df <- df_graphs 

#MAKER AGE
ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_AGE)) +
  geom_bar(position = "fill") +
  #SCALES & SPACE FREE SUPPRESSES EMPTY ROWS
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ Distribution, scales = "free", space = "free") + 
  labs( title = "MAKER AGE by Stimulus (grouped by CATEGORY) ",
        subtitle = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  coord_flip()+
  # easy_add_legend_title("") +
  theme_minimal()

```

### Maker Age by Category

```{r maker-age-category}

df <- df_graphs 

#MAKER AGE
ggplot( df, aes( x = STIMULUS_CATEGORY, fill = MAKER_AGE)) +
  geom_bar(position = "fill") +
  facet_grid(Distribution ~ .) + 
  labs( title = "MAKER AGE by Stimulus Category",
        subtitle = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  # facet_grid(rows= vars(D_age)) +
  coord_flip()+
  theme_minimal()

```

### Maker Age & Confidence by Stimulus

```{r maker-age-confidence-stimulus, message=FALSE, warning=FALSE, fig.width=10}

#FILTER DATAFRAME
df <- df_graphs 

######### MAKER ID AND CONFIDENCE ##############
# MAKER_ID by Sample and BEHAVIOR 
a <- ggplot (df, aes( x = fct_rev(STIMULUS), fill = MAKER_AGE)) + 
  geom_bar(position = "fill", width = 0.8) +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  # facet_grid( df$ENCOUNTER) + 
  labs (x = "") + 
  theme_minimal() 

# MAKER_CONFIDENCE by IDENTIFICATION  
b <- ggplot(df, aes( x = fct_rev(STIMULUS), y = MAKER_CONF, color = MAKER_AGE)) + 
  geom_boxplot(position=position_dodge(0.9), width = 0.5)+
  geom_jitter(position=position_jitterdodge(), alpha = 0.2) + 
  scale_color_viridis(discrete=TRUE, option="viridis") +
  labs (title = "") +
  labs (x = "STIMULUS CATEGORY") + 
  theme_minimal() 

(p <- (a / b )  + plot_annotation(
  title = 'MAKER AGE & CONFIDENCE by Category',
  subtitle = '',
  caption = ''))

###################################################

rm(a,b,p)
```
### Maker Age & Confidence by Category

```{r maker-age-confidence-category, message=FALSE, warning=FALSE}

#FILTER DATAFRAME
df <- df_graphs 

######### MAKER ID AND CONFIDENCE ##############
# MAKER_AGE by Sample and BEHAVIOR 
a <- ggplot (df, aes( x = fct_rev(STIMULUS_CATEGORY), fill = MAKER_AGE)) + 
  geom_bar(position = "fill") + #dodge
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  # facet_grid( df$ENCOUNTER) + 
  labs (x = "") + 
  theme_minimal() 

# MAKER_CONFIDENCE by IDENTIFICATION  
b <- ggplot(df, aes( x = fct_rev(STIMULUS_CATEGORY), y = AGE_CONF, color = MAKER_AGE)) + 
  geom_boxplot(position=position_dodge(0.9))+
  geom_jitter(position=position_jitterdodge(), alpha = 0.2) + 
  scale_color_viridis(discrete=TRUE, option="viridis") +
  labs (x = "STIMULUS CATEGORY") + 
  theme_minimal() 

(p <- (a / b )  + plot_annotation(
  title = 'MAKER AGE & CONFIDENCE by Category',
  subtitle = '',
  caption = ''))

###################################################

rm(a,b,p)
```


## MAKER GENDER

### Maker Gender by Stimulus
```{r maker-gender-stimulus}

df <- df_graphs 

#MAKER GENDER
ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_GENDER)) +
  geom_bar(position = "fill") +
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ Distribution, scales = "free", space = "free") + 
  labs( title = "MAKER GENDER by Stimulus (grouped by CATEGORY) ",
        subtitle = "", x = "") +
  # scale_fill_viridis(discrete=TRUE, option="viridis") +
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  coord_flip()+
  # easy_add_legend_title("") +
  theme_minimal()


#MAKER GENDER
ggplot( df, aes( x = fct_rev(STIMULUS), fill = fct_rev(MAKER_GENDER))) +
  geom_bar(position = "fill") +
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ ., scales = "free", space = "free") + 
  labs( title = "MAKER GENDER by Stimulus (grouped by CATEGORY) ",
        subtitle = "", x = "") +
  # scale_fill_viridis(discrete=TRUE, option="viridis") +
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  coord_flip()+
  # easy_add_legend_title("") +
  theme_minimal()


#MAKER GENDER
ggplot( df, aes( x = fct_rev(STIMULUS), fill = fct_rev(MAKER_GENDER))) +
  geom_bar(position = "fill") +
  facet_grid(.~fct_rev(STIMULUS_CATEGORY) , scales = "free", space = "free") + 
  labs( title = "MAKER GENDER by Stimulus (grouped by CATEGORY) ",
        subtitle = "", x = "") +
  # scale_fill_viridis(discrete=TRUE, option="viridis") +
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  # coord_flip()+
  # easy_add_legend_title("") +
  theme_minimal()


#MAKER GENDER

ggbarstats( data = df, x = "MAKER_GENDER", y = "STIMULUS",
                 legend.title = "MAKER_GENDER")  +
      scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
      labs( title = "MAKER_GENDER ", subtitle = "", x = "") 






#MAKER GENDER by PARTICIPANT GENDER
ggplot( df, aes( x = fct_rev(STIMULUS), fill = fct_rev(MAKER_GENDER))) +
  geom_bar(position = "fill") +
  facet_grid(D_gender~fct_rev(STIMULUS_CATEGORY) , scales = "free", space = "free") + 
  labs( title = "MAKER GENDER by Stimulus (grouped by CATEGORY) ",
        subtitle = "", x = "") +
  # scale_fill_viridis(discrete=TRUE, option="viridis") +
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  # coord_flip()+
  # easy_add_legend_title("") +
  theme_minimal()



```
### Maker Gender by Category

```{r maker-gender-category}

df <- df_graphs 

#MAKER GENDER
ggplot( df, aes( x = STIMULUS_CATEGORY, fill = MAKER_GENDER)) +
  geom_bar(position = "fill") +
  facet_grid(Distribution ~ .)+
  labs( title = "MAKER GENDER by Stimulus Category",
        subtitle = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  # facet_grid(rows= vars(D_age)) +
  coord_flip()+
  theme_minimal()

```

### Maker Gender & Confidence by Stimulus

```{r maker-gender-confidence-stimulus, message=FALSE, warning=FALSE, fig.width=10}

#FILTER DATAFRAME
df <- df_graphs 

######### MAKER GENDER AND CONFIDENCE ##############
# MAKER_GENDER by STIMULUS
a <- ggplot (df, aes( x = fct_rev(STIMULUS), fill = MAKER_GENDER)) + 
  geom_bar(position = "fill", width = 0.8) +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  # facet_grid( df$ENCOUNTER) + 
  labs (x = "") + 
  theme_minimal() 

# GENDER_CONFIDENCE by STIMULUS
b <- ggplot(df, aes( x = fct_rev(STIMULUS), y = GENDER_CONF, color = MAKER_GENDER)) + 
  geom_boxplot(position=position_dodge(0.9), width = 0.5)+
  geom_jitter(position=position_jitterdodge(), alpha = 0.2) + 
  scale_color_viridis(discrete=TRUE, option="viridis") +
  labs (x = "STIMULUS") + 
  theme_minimal() 

(p <- (a / b )  + plot_annotation(
  title = 'MAKER GENDER & CONFIDENCE by Stimulus',
  subtitle = '',
  caption = ''))

###################################################

rm(a,b,p)
```

### Maker Gender & Confidence by Category

```{r maker-gender-confidence-category, message=FALSE, warning=FALSE}

#FILTER DATAFRAME
df <- df_graphs 

######### MAKER GENDER AND CONFIDENCE ##############
a <- ggplot (df, aes( x = fct_rev(STIMULUS_CATEGORY), fill = MAKER_GENDER)) + 
  geom_bar(position = "fill") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  # facet_grid( df$ENCOUNTER) + 
  labs (x = "") + 
  theme_minimal() 

# GENDER_CONFIDENCE by GENDER  
b <- ggplot(df, aes( x = fct_rev(STIMULUS_CATEGORY), y = GENDER_CONF, color = MAKER_GENDER)) + 
  geom_boxplot(position=position_dodge(0.9))+
  geom_jitter(position=position_jitterdodge(), alpha = 0.2) + 
  scale_color_viridis(discrete=TRUE, option="viridis") +
  labs (x = "STIMULUS CATEGORY") + 
  theme_minimal() 

(p <- (a / b )  + plot_annotation(
  title = 'MAKER GENDER & CONFIDENCE by Category',
  subtitle = '',
  caption = ''))

###################################################

rm(a,b,p)
```

## TOOL CHOICE

### Tool ID by Stimulus

```{r toolid-stimulus}

df <- df_tools 

# TOOL CHOICE BY STIMULUS
ggplot(data = df, aes( fill = fct_rev(TOOL_ID), x = fct_rev(STIMULUS) )) +
  geom_bar(position = "fill") +
  coord_flip() + 
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ Distribution, scales = "free", space = "free") + 
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  scale_y_continuous(labels = scales::percent) + 

  labs( title = "TOOL ID by Stimulus (grouped by Category)",
        subtitle = "", x = "") +
  easy_add_legend_title("TOOL_ID") +
  theme_minimal() 


```

### Tool ID by Category

```{r toolid-category}

df <- df_tools 

# TOOL CHOICE BY STIMULUS
ggplot(data = df, aes( fill = fct_rev(TOOL_ID), x = STIMULUS_CATEGORY )) +
  geom_bar(position = "fill") +
  facet_grid(Distribution ~ .) + 
  coord_flip() + 
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  scale_y_continuous(labels = scales::percent) + 
  labs( title = "TOOL ID by Category",
        subtitle = "", x = "") +
  easy_add_legend_title("TOOL_ID") +
  theme_minimal() 


```

### Tool ID & Confidence by Stimulus

```{r toolid-confidence-stimulus, message=FALSE, warning=FALSE, fig.width = 10}

#FILTER DATAFRAME
df <- df_tools 

######### TOOL ID AND CONFIDENCE ##############
a <- ggplot (df, aes( x = fct_rev(STIMULUS), fill = fct_rev(TOOL_ID))) + 
  geom_bar(position = "fill", width = 0.8) +
  scale_fill_paletteer_d("awtools::a_palette", direction = 1) +
  # facet_grid( df$ENCOUNTER) + 
  labs (x = "") +
  easy_add_legend_title("TOOL ID")+
  theme_minimal() 

# TOOL_CONFIDENCE by STIMULUS
b <- ggplot(df, aes( x = fct_rev(STIMULUS), y = TOOL_CONF, color = fct_rev(TOOL_ID))) + 
  geom_boxplot(position=position_dodge(0.9), width = 0.6)+
  geom_jitter(position=position_jitterdodge(), alpha = 0.2) + 
  scale_color_paletteer_d("awtools::a_palette", direction = 1) +
  labs (x = "STIMULUS") + 
  easy_add_legend_title("TOOL ID")+
  theme_minimal() 

(p <- (a / b )  + plot_annotation(
  title = 'TOOL ID & CONFIDENCE by Stimulus',
  subtitle = '',
  caption = ''))

###################################################

rm(a,b,p)
```

### Tool ID & Confidence by Category

```{r toolid-confidence-category, message=FALSE, warning=FALSE}

#FILTER DATAFRAME
df <- df_tools 

######### TOOL ID AND CONFIDENCE ##############
a <- ggplot (df, aes( x = fct_rev(STIMULUS_CATEGORY), fill = fct_rev(TOOL_ID))) + 
  geom_bar(position = "fill") +
  scale_fill_paletteer_d("awtools::a_palette", direction = 1) +
  # facet_grid( df$ENCOUNTER) + 
  labs (x = "") + 
  easy_add_legend_title("TOOL ID")+
  theme_minimal() 

# TOOL CONF 
b <- ggplot(df, aes( x = fct_rev(STIMULUS_CATEGORY), y = TOOL_CONF, color = fct_rev(TOOL_ID))) + 
  geom_boxplot(position=position_dodge(0.9))+
  geom_jitter(position=position_jitterdodge(), alpha = 0.2) + 
  scale_color_paletteer_d("awtools::a_palette", direction = 1) +
  labs (x = "STIMULUS CATEGORY") + 
  easy_add_legend_title("TOOL ID")+
  theme_minimal() 

(p <- (a / b )  + plot_annotation(
  title = 'TOOL ID & CONFIDENCE by Category',
  subtitle = '',
  caption = ''))

###################################################

rm(a,b,p)
```





## ENCOUNTER CHOICE

### Encounter Choice by Stimulus
```{r encounter-stimulus}

df <- df_graphs 

#MAKER IDENTIFICATION
ggplot( df, aes( x = fct_rev(STIMULUS), fill = ENCOUNTER)) +
  geom_bar(position = "fill") +
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ Distribution, scales = "free", space = "free") + 
  labs( title = "MAKER ENCOUNTER by Stimulus (grouped by CATEGORY) ",
        subtitle = "", x = "") +
  scale_fill_brewer(palette = "Dark2") + 
  # scale_fill_viridis(discrete=TRUE, option="viridis", direction = -1) +
  coord_flip()+
  # easy_add_legend_title("") +
  theme_minimal()

```


### Encounter Choice by Category

```{r encounter-category}

df <- df_graphs 

#MAKER IDENTIFICATION
ggplot( df, aes( x = STIMULUS_CATEGORY, fill = ENCOUNTER)) +
  geom_bar(position = "fill") +
  facet_grid(Distribution ~ .) + 
  labs( title = "ENCOUNTER by Stimulus Category (grouped by CATEGORY)",
        subtitle = "", x = "") +
  scale_fill_brewer(palette = "Dark2") + 
  coord_flip()+
  theme_minimal()

```







## ENGAGEMENT CHOICE

### Actions Choice by Stimulus

```{r actions-stimulus}

df <- df_actions 

# ACTION CHOICE BY STIMULUS
ggplot(data = df, aes( fill = CHART_ACTION, x = fct_rev(STIMULUS) )) +
  geom_bar(position = "fill") +
  coord_flip() + 
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ Distribution, scales = "free", space = "free") + 
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  scale_y_continuous(labels = scales::percent) + 

  labs( title = "Chart Action by Stimulus (grouped by Category)",
        subtitle = "", x = "") +
  easy_add_legend_title("ACTION") +
  theme_minimal() 



# ACTION CHOICE BY STIMULUS
ggplot(data = df, aes( fill = CHART_ACTION, x = fct_rev(STIMULUS) )) +
  geom_bar(position = "fill") +
  coord_flip() + 
  facet_grid(fct_rev(STIMULUS_CATEGORY) ~ ., scales = "free", space = "free") + 
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  scale_y_continuous(labels = scales::percent) + 

  labs( title = "Chart Action by Stimulus (grouped by Category)",
        subtitle = "", x = "") +
  easy_add_legend_title("ACTION") +
  theme_minimal() 



```

### Actions Choice by Category

```{r actions-category}

df <- df_actions 

# ACTION CHOICE BY STIMULUS
ggplot(data = df, aes( fill = CHART_ACTION, x = STIMULUS_CATEGORY )) +
  geom_bar(position = "fill") +
  facet_grid(Distribution ~ .) + 
  coord_flip() + 
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  scale_y_continuous(labels = scales::percent) + 
  labs( title = "CHART ACTION by Category",
        subtitle = "", x = "") +
  easy_add_legend_title("ACTION") +
  theme_minimal() 


```






## CHART BEAUTY

### Chart Beauty by Stimulus and Category
```{r}

df <- df_graphs

qacBase::qstats(df, CHART_BEAUTY, STIMULUS) %>% arrange(mean)

qacBase::qstats(df, CHART_BEAUTY, STIMULUS_CATEGORY) %>% arrange(mean)

# 
# 
# ggplot(df, aes(x = CHART_BEAUTY)) + 
#   geom_histogram(bins = 20) +
#   facet_grid(BLOCK ~ STIMULUS_CATEGORY, scales = "free", space = "free", drop=TRUE) + 
#   theme_minimal()
# 
# 
# ggplot(df, aes(x = CHART_BEAUTY)) + 
#   geom_histogram(bins = 20) +
#   facet_grid( ~ fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free", drop=TRUE) + 
#   theme_minimal()
# 



##ggstatsplot BY CATEGORY
grouped_gghistostats(
  data = df_graphs %>% filter(STIMULUS != "B0-0"),
  x = CHART_BEAUTY, ## same outcome variable
  grouping.var = STIMULUS, ## grouping variable males = 1, females = 2
  type = "robust", ## robust test: one-sample percentile bootstrap
  test.value = 50, ## test value against which sample mean is to be compared
  centrality.line.args = list(color = "#D55E00", linetype = "dashed"),
  # ggtheme = ggthemes::theme_stata(), ## changing default theme
  ## turn off ggstatsplot theme layer
  ## arguments relevant for combine_plots
  annotation.args = list(
    title = "DISTRIBUTION of Chart Beauty by Cateogry",
    caption = ""
  ),
  plotgrid.args = list(nrow = 6)
)
 

#B0-0 
gghistostats(
  data = df_graphs %>% filter(STIMULUS == "B0-0"), ## data from which variable is to be taken
  x = CHART_BEAUTY, ## numeric variable
  xlab = "CHART BEAUTY", ## x-axis label
  title = "B0-0 MILLENIAL PINK PLANTS", ## title for the plot
  test.value = 50, ## test value
  caption = ""
)  


```

### Chart Trust by Stimulus and Category
```{r}

df <- df_graphs

qacBase::qstats(df, CHART_TRUST, STIMULUS) %>% arrange(mean)

qacBase::qstats(df, CHART_TRUST, STIMULUS_CATEGORY) %>% arrange(mean)


##ggstatsplot BY CATEGORY
grouped_gghistostats(
  data = df_graphs %>% filter(STIMULUS != "B0-0"),
  x = CHART_TRUST, ## same outcome variable
  grouping.var = STIMULUS, ## grouping variable males = 1, females = 2
  type = "robust", ## robust test: one-sample percentile bootstrap
  test.value = 50, ## test value against which sample mean is to be compared
  centrality.line.args = list(color = "#D55E00", linetype = "dashed"),
  # ggtheme = ggthemes::theme_stata(), ## changing default theme
  ## turn off ggstatsplot theme layer
  ## arguments relevant for combine_plots
  annotation.args = list(
    title = "DISTRIBUTION of Chart TRUST by Cateogry",
    caption = ""
  ),
  plotgrid.args = list(nrow = 6)
)
 

#B0-0 
gghistostats(
  data = df_graphs %>% filter(STIMULUS == "B0-0"), ## data from which variable is to be taken
  x = CHART_TRUST, ## numeric variable
  xlab = "CHART TRUST", ## x-axis label
  title = "B0-0 MILLENIAL PINK PLANTS", ## title for the plot
  test.value = 50, ## test value
  caption = ""
)  


```


# FISH

### bivariate combinations 
```{r bivariate-demos}

if(graph_render == TRUE){





### EXPLORE ALL QUESTIONS AS EXPLAINED BY DEMOGRAPHICS
df <- df_graphs 
predictors = df %>% select(Distribution, STIMULUS_CATEGORY,
                D_gender_collapsed, D_age, D_education, D_income,
                D_politicalParty, D_politicsFiscal, D_politicsSocial) %>% colnames()

questions = c(ref_sd_questions, ref_conf_questions, ref_cat_questions)

i=0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  g <- ggbivariate(df, outcome = q, explanatory = predictors) + labs(
    title = paste0(q, " as explained by demographic variables")
  )+ theme_minimal()
  ggsave(plot = g, path="figs/bivariate/bivariate_demographics", filename =paste0(q,"_demo_ggbivariate.png"), units = c("in"), width = 10, height = 25)
}
rm(i,g)
#####################################################END




### EXPLORE ALL QUESTIONS AS EXPLAINED BY SD VARS
df <- df_graphs 
predictors = c(ref_sd_questions)
questions = c(ref_sd_questions, ref_conf_questions, ref_cat_questions)
i=0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  g <- ggbivariate(df, outcome = q, explanatory = predictors) + labs(
    title = paste0(q, " as explained by SD variables")
  )+ theme_minimal()
  ggsave(plot = g, path="figs/bivariate/bivariate_SD", filename =paste0(q,"_sd_ggbivariate.png"), units = c("in"), width = 10, height = 25)
}
rm(i,g )
#####################################################END



### EXPLORE ALL QUESTIONS AS EXPLAINED BY CONF VARS
df <- df_graphs 
predictors = c(ref_conf_questions)
questions = c(ref_sd_questions, ref_conf_questions, ref_cat_questions)
i=0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  g <- ggbivariate(df, outcome = q, explanatory = predictors) + labs(
    title = paste0(q, " as explained by CONF variables")
  )+ theme_minimal()
  ggsave(plot = g, path="figs/bivariate/bivariate_CONF", filename =paste0(q,"_conf_ggbivariate.png"), units = c("in"), width = 10, height = 25)
}
rm(i,g)
#####################################################END


### EXPLORE ALL QUESTIONS AS EXPLAINED BY CAT VARS
df <- df_graphs 
predictors = c(ref_cat_questions)
questions = c(ref_sd_questions, ref_conf_questions, ref_cat_questions)
i=0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  g <- ggbivariate(df, outcome = q, explanatory = predictors) + labs(
    title = paste0(q, " as explained by CATEGORICAL variables")
  )+ theme_minimal()
  ggsave(plot = g, path="figs/bivariate/bivariate_CAT", filename =paste0(q,"_cat_ggbivariate.png"), units = c("in"), width = 10, height = 25)
}
rm(i,g)
#####################################################END


}

```


### DEMO-GENDER > MAKER-GENDER?

```{r}

df <- df_graphs %>% select(PID, D_gender, MAKER_GENDER, GENDER_CONF, STIMULUS, STIMULUS_CATEGORY, BLOCK)


## ALL STIMULI
ggplot(df, aes(x = MAKER_GENDER, fill= D_gender)) + 
  geom_bar(position = "stack")  + 
  scale_fill_viridis(discrete=TRUE, option="viridis") + 
  theme_minimal() + 
  labs(
    title = "MAKER GENDER by participant gender",
    subtitle = "(across all stimuli)",
    caption = "ARF: Attribution of maker gender does not *appear* to differ by participant \n gender identity; Each personal gender has attributions to each maker gender"
  )



## CATEGORY
ggplot(df, aes(x = MAKER_GENDER, fill= D_gender)) + 
  geom_bar(position = "stack")  + 
  facet_grid(.~fct_rev(STIMULUS_CATEGORY))+
  scale_fill_viridis(discrete=TRUE, option="viridis") + 
  theme_minimal() + 
  labs(
    title = "MAKER GENDER by participant gender",
    subtitle = "(by stimulus category)",
    caption = "ARF: Note that across categories most attributions are male, 
    EXCEPT F (millenial pink plants) which is largely female
    HOWEVER relative proportion by participant gender looks consistent" 
  )


## STIMULUS
ggplot(df, aes(x = MAKER_GENDER, fill= D_gender)) + 
  geom_bar(position = "stack")  + 
  facet_grid(BLOCK~fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free")+
  scale_fill_viridis(discrete=TRUE, option="viridis")+
  theme_minimal() + 
  labs(
    title = "MAKER GENDER by participant gender",
    subtitle = "(by stimulus)",
    caption = "ARF: Again, relative proportions look consistent by participant gender"
  )

## B00
df <- df %>% filter(STIMULUS=="B0-0")
ggplot(df, aes(x = MAKER_GENDER, fill= D_gender)) + 
  geom_bar(position = "stack")  + 
  facet_grid(BLOCK~fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free")+
  scale_fill_viridis(discrete=TRUE, option="viridis")+
  theme_minimal() + 
  labs(
    title = "MAKER GENDER by participant gender",
   subtitle = "B0-0 MILLENIAL PINK PLANTS",
    caption = "ARF: Most attributions are FEMALE but relative proportion of 
    participant gender appears comparable; difficult to detect due to low number
    of non-binary, prefer not to say, prefer to self-describe"
  )

```
### DEMO-GENDER_Q_all_stimuli
```{r GENDER-Q-FOR-ALL-STIMULI}

##ONLY RENDER GRAPHS IF SET TO TRUE
if(graph_render == TRUE){

####################CREATE SD PLOTS FOR EACH QUESTION#####################

#set questions to be graphed 
questions <- ref_sd_questions  #created in wrangling block
box_s_question <- list()
rain_s_question <- list()
i = 0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  df <- df_sd_questions_wide %>% filter(QUESTION == q)

  #subset data cols 
  c <- df %>% select( all_of(ref_stimuli)) ##TODO IF NOT WORK ref_stim_id
  # plot_sd = function (data, column, type, facet, facet_by,  boxplot) {

  plots <- as.list(lapply(colnames(c), plot_sd, data = df, type = "Q", facet=TRUE, facet_by= "D_gender_collapsed", boxplot=TRUE)) 
  
  #aggregate stimulus plots into block for question
  x <- plots[[1]] / plots[[2]]  / plots[[3]] / plots[[4]] / plots[[5]] / plots[[6]] / plots[[7]] /
        plots[[8]] /plots[[9]] /plots[[10]] /plots[[11]] /  plots[[12]] / plots[[13]] / plots[[14]] / 
        plots[[15]] /plots[[16]] /plots[[17]] /plots[[18]] /  plots[[19]] / plots[[20]] / plots[[21]] /
        plots[[22]] /plots[[23]] /plots[[24]] /plots[[25]] + 
      plot_annotation(
        title = title,
       subtitle =""
      )
  box_s_question[[i]] <- x 
  ggsave(plot = x, path="figs/GENDER_by_q_for_all_stimuli", filename =paste0(q,"_box.png"), units = c("in"), width = 10, height = 26)

  
  
  
  ############# RAINCLOUD
  # setup dataframe 
  title <- paste(q)
  df <- df_sd_questions_long %>% filter(QUESTION ==q)
    #select(1:6, QUESTION, all_of(s)) %>% filter(!is.na(s)) %>%  mutate(value = get(s))
  left <- ref_labels[q,]$left
  right <- ref_labels[q,]$right

  #RAINCLOUD PLOT
  x <- ggplot(df, aes(y = fct_rev(STIMULUS) , x = value, fill = fct_rev(STIMULUS))) +
      stat_slab(normalize="groups", scale = 0.7) +
      stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
    facet_grid(~D_gender_collapsed)+
  guides(
    y = guide_axis_manual(labels = left),
    y.sec = guide_axis_manual(labels = right)
  ) +
  labs (title = title) +
  theme_minimal() 
   
  
  rain_s_question[[i]] <- x
  ggsave(plot = x, path="figs/GENDER_by_q_for_all_stimuli", filename =paste0(q,"_rain.png"), units = c("in"), width = 10, height = 14  )
  

  
}

#GIVE NAMES TO LIST
#NOW CAN ACCESS plots by plots_s_question$MAKER_DESIGN
#ALSO plots_s_question$MAKER_DESIGN[[1]]
names(box_s_question) <- questions
names(rain_s_question) <- questions
rm(x, i, plots, left, right)

#############################################################################

}
```

### DEMO-GENDER-MILLENIAL-PLANTS-SDS
```{r GENDER-PLANTS ALL-Q-BY-STIMULUS}


#################### ALL QUESTIONS AT B00 #####################
# ONE PLOT FOR EACH STIMULUS WITH ALL QUESTIONS

#set stimuli to be graphed 
# stimuli <- ref_stimuli #created in wrangling block ##TODO IF NOT WORK ref_stim_id
stimuli <- c("B0-0")

box_stimuli <- list()
rain_stimuli <- list()
i = 0
for (s in stimuli){
  i = i+1
  
  # setup dataframe 
  title <- ref_stimuli %>% filter(ID == s) %>% select(NAME) ##TODO IF NOT WORK ref_stim_id
  title <- paste(s,"|",title)
  df <- df_graphs %>% filter(STIMULUS== s)

  #subset data cols 
  cols <- df %>% select( all_of(ref_sd_questions))
  plots <- as.list(lapply(colnames(cols), plot_sd, data = df, type ="S", facet = TRUE, facet_by="D_gender_collapsed", boxplot=TRUE))

  #aggregate q plots into one for stimulus 
  x <- plots[[1]] / plots[[2]] / plots[[3]] / plots[[4]] / plots[[5]] / plots[[6]] / plots[[7]] /
   plots[[8]] /plots[[9]] /plots[[10]] /plots[[11]] + 
   plot_annotation(
     title = title,
     subtitle =""
   )
  
  box_stimuli[[i]] <- x
  ggsave(plot = x, path="figs/_millenial-pink-plants", filename =paste0(s,"_box.png"), units = c("in"), width = 10, height = 14  )
  
  
  #### RAINCLOUD PLOT
  # setup dataframe 
  title <- ref_stimuli %>% filter(ID == s) %>% select(NAME) ##TODO IF NOT WORK ref_stim_id
  title <- paste(s,"|",title)
  df <- df_sd_questions_wide %>% select(1:6, D_gender_collapsed, QUESTION, all_of(s)) %>% filter(!is.na(s)) %>%  mutate(value = get(s))


  #RAINCLOUD PLOT
  x <- ggplot(df, aes(y = fct_rev(QUESTION), x = value, fill = fct_rev(QUESTION))) +
  stat_slab(aes(thickness = after_stat(pdf*n)), scale = 0.7) +
  stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
  facet_grid(~ D_gender_collapsed)+
  guides(
    # y = guide_axis_manual(labels = paste(levels(df$QUESTION),ref_labels$left)),
    y = guide_axis_manual(labels = rev(ref_labels$left)),
    y.sec = guide_axis_manual(labels = rev(ref_labels$right))
  ) + 
  labs (title = title) +
  theme_minimal() 
   
  
  rain_stimuli[[i]] <- x
  ggsave(plot = x, path="figs/_millenial-pink-plants", filename =paste0(s,"_rain.png"), units = c("in"), width = 10, height = 14  )
  
}

#GIVE NAMES TO LIST
#NOW CAN ACCESS plots by plots_stimulus$`B1-1`
#ALSO plots_stimulus$`B1-1`[[1]]
names(box_stimuli) <- stimuli
names(rain_stimuli) <- stimuli
rm(x, i, plots)

#############################################################################
 

```


### DEMO-GENDER-MILLENIAL-PLANTS-CATS
```{r}


#filter dataframe
df <- df_graphs %>% select(PID, D_gender_collapsed, MAKER_GENDER, GENDER_CONF, MAKER_AGE, AGE_CONF, MAKER_ID, MAKER_CONF, STIMULUS, STIMULUS_CATEGORY, BLOCK) %>% filter(STIMULUS=="B0-0")


##ID
p <- ggplot(df, aes(x = MAKER_ID, fill= D_gender_collapsed)) + 
  geom_bar(position = "fill")  + 
  facet_grid(BLOCK~fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free")+
  theme_minimal() + 
  labs(
    title = "MAKER ID by participant gender (proportion)",
    subtitle = "B0-0 MILLENIAL PINK PLANTS",
    caption = ""
  )

s <- ggplot(df, aes(x = MAKER_ID, fill= D_gender_collapsed)) + 
  geom_bar(position = "stack")  + 
  facet_grid(BLOCK~fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free")+
  theme_minimal() + 
  labs(
    title = "MAKER ID by participant gender (true count)",
    subtitle = "B0-0 MILLENIAL PINK PLANTS",
    caption = ""
  )

(p/s)

##AGE
p <- ggplot(df, aes(x = MAKER_AGE, fill= D_gender_collapsed)) + 
  geom_bar(position = "fill")  + 
  facet_grid(BLOCK~fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free")+
  theme_minimal() + 
  labs(
    title = "MAKER AGE by participant gender (proportion)",
    subtitle = "B0-0 MILLENIAL PINK PLANTS",
    caption = ""
  )

s <- ggplot(df, aes(x = MAKER_AGE, fill= D_gender_collapsed)) + 
  geom_bar(position = "stack")  + 
  facet_grid(BLOCK~fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free")+
  theme_minimal() + 
  labs(
    title = "MAKER AGE by participant gender (true count)",
    subtitle = "B0-0 MILLENIAL PINK PLANTS",
    caption = ""
  )

(p/s)


##GENDER
p <- ggplot(df, aes(x = MAKER_GENDER, fill= D_gender_collapsed)) + 
  geom_bar(position = "fill")  + 
  facet_grid(BLOCK~fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free")+
  theme_minimal() + 
  labs(
    title = "MAKER GENDER by participant gender (proportion)",
    subtitle = "B0-0 MILLENIAL PINK PLANTS",
    caption = "ARF: Proportion of OTHER looks high!"
  )

s <- ggplot(df, aes(x = MAKER_GENDER, fill= D_gender_collapsed)) + 
  geom_bar(position = "stack")  + 
  facet_grid(BLOCK~fct_rev(STIMULUS_CATEGORY), scales = "free", space = "free")+
  theme_minimal() + 
  labs(
    title = "MAKER GENDER by participant gender (true count)",
    subtitle = "B0-0 MILLENIAL PINK PLANTS",
    caption = "ARF: But count of other is very low :("
  )

(p/s)


##MAKER CONFIDENCE BY GENDER 
ggplot(df, aes(x=D_gender_collapsed, y = MAKER_CONF, color = D_gender_collapsed))+
  geom_jitter(width=0.2, height = 0) + 
  labs (title = "CONFIDENCE in MAKER_ID by Participant Gender",
        x = "participant gender")+
  theme_minimal() +
  easy_remove_legend()


##AGE CONFIDENCE BY GENDER 
ggplot(df, aes(x=D_gender_collapsed, y = AGE_CONF, color = D_gender_collapsed))+
  geom_jitter(width=0.2, height = 0) + 
  labs (title = "CONFIDENCE in MAKER_AGE by Participant Gender",
        x = "participant gender")+
  theme_minimal() +
  easy_remove_legend()


##GENDER CONFIDENCE BY GENDER 
ggplot(df, aes(x=D_gender_collapsed, y = GENDER_CONF, color = D_gender_collapsed))+
  geom_jitter(width=0.2, height = 0) + 
  labs (title = "CONFIDENCE in MAKER_GENDER by Participant Gender",
        x = "participant gender")+
  theme_minimal() +
  easy_remove_legend()

```

# B1-3 AGGRESSIVE AMERICAN FLAG

## demographics

```{r b13-demographics}

n = df_participants %>% filter(Assigned.Block == 1) %>% nrow()
print(paste(n, "participants were assigned to block 1 where they saw the 'aggressive american flag stimulus"))
```

## bar charts 

```{r OMINOUS-FLAG}


df <- df_graphs %>% filter(STIMULUS == "B1-3")

#MAKER IDENTIFICATION
ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_ID)) +
  geom_bar(position = "fill") +
  labs( title = "MAKER ID [B1-C]) ",
        subtitle = "", x = "") +
  scale_fill_viridis(discrete=TRUE, option="viridis") +
  easy_add_legend_title("") +
  theme_minimal()


#MAKER AGE
ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_AGE)) +
  geom_bar(position = "fill") +
  labs( title = "MAKER AGE [B1-C] ",
        subtitle = "", x = "") +
  scale_fill_paletteer_d("ggsci::light_uchicago", direction = -1)+
  theme_minimal()



#MAKER GENDER
ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_GENDER)) +
  geom_bar(position = "fill") +
  # facet_grid(D_gender_collapsed ~ ., scales = "free", space = "free") + 
  labs( title = "MAKER GENDER [B1-C] ",
        subtitle = "", x = "") +
  scale_fill_paletteer_d("ggthemes::excel_Celestial", direction = 1)+
  theme_minimal()



df <- df_tools %>% filter (STIMULUS =="B1-3")

# TOOL CHOICE BY STIMULUS
ggplot(data = df, aes( fill = fct_rev(TOOL_ID), x = fct_rev(STIMULUS) )) +
  geom_bar(position = "fill") +
  # coord_flip() + 
  # facet_grid(fct_rev(STIMULUS_CATEGORY) ~ Distribution, scales = "free", space = "free") + 
  scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
  scale_y_continuous(labels = scales::percent) + 
  labs( title = "TOOL ID by Stimulus (grouped by Category)",
        subtitle = "", x = "") +
  easy_add_legend_title("TOOL_ID") +
  theme_minimal() 

```
```{r angry-flag-age-by-sample}

df <- df_graphs %>% filter(STIMULUS == "B1-3")

#MAKER AGE
ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_AGE)) +
  geom_bar(position = "fill") +
  facet_grid(.~Distribution) + 
  labs( title = "MAKER AGE [B1-C] ",
        subtitle = "", x = "") +
  scale_fill_paletteer_d("ggsci::light_uchicago", direction = -1)+
  theme_minimal()


```

## pie charts 

```{r OMINOUS-FLAG}


# df <- df_graphs %>% filter(STIMULUS == "B1-3")
# 
# #MAKER IDENTIFICATION
# ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_ID)) +
#   geom_bar(position = "fill") +
#   labs( title = "MAKER ID [B1-C]) ",
#         subtitle = "", x = "") +
#   scale_fill_viridis(discrete=TRUE, option="viridis") +
#   easy_add_legend_title("") +
#   theme_minimal()
# 
# 
# #MAKER AGE
# ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_AGE)) +
#   geom_bar(position = "fill") +
#   labs( title = "MAKER AGE [B1-C] ",
#         subtitle = "", x = "") +
#   scale_fill_paletteer_d("ggsci::light_uchicago", direction = -1)+
#   theme_minimal()
# 
# 
# 
# #MAKER GENDER
# ggplot( df, aes( x = fct_rev(STIMULUS), fill = MAKER_GENDER)) +
#   geom_bar(position = "fill") +
#   # facet_grid(D_gender_collapsed ~ ., scales = "free", space = "free") + 
#   labs( title = "MAKER GENDER [B1-C] ",
#         subtitle = "", x = "") +
#   scale_fill_paletteer_d("ggthemes::excel_Celestial", direction = 1)+
#   theme_minimal()
# 
# 
# 
# df <- df_tools %>% filter (STIMULUS =="B1-3")
# 
# # TOOL CHOICE BY STIMULUS
# ggplot(data = df, aes( fill = fct_rev(TOOL_ID), x = fct_rev(STIMULUS) )) +
#   geom_bar(position = "fill") +
#   # coord_flip() + 
#   # facet_grid(fct_rev(STIMULUS_CATEGORY) ~ Distribution, scales = "free", space = "free") + 
#   scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
#   scale_y_continuous(labels = scales::percent) + 
#   labs( title = "TOOL ID by Stimulus (grouped by Category)",
#         subtitle = "", x = "") +
#   easy_add_legend_title("TOOL_ID") +
#   theme_minimal() 
# 
# 
# 
# 
# 
# 
# 
# 
# #### GG_LOT + GREPL
# library(ggrepel)
# df <- df_graphs %>% filter(STIMULUS == "B1-3") %>% select(STIMULUS, MAKER_ID) %>% 
#   group_by(MAKER_ID) %>% 
#   summarize(
#     value = n()
#   )
# df2 <- df %>% 
#   mutate(csum = rev(cumsum(rev(value))), 
#          pos = value/2 + lead(csum, 1),
#          pos = if_else(is.na(pos), value/2, pos))
# 
# ggplot(df, aes(x = "" , y = value, fill = fct_inorder(MAKER_ID))) +
#   geom_col(width = 1, color = 1) +
#   coord_polar(theta = "y") +
#   scale_fill_brewer(palette = "Pastel1") +
#   geom_label_repel(data = df2,
#                    aes(y = pos, label = paste0(value, "%")),
#                    size = 4.5, nudge_x = 1, show.legend = FALSE) +
#   guides(fill = guide_legend(title = "Group")) +
#   theme_void()


##GGPIESTATS MAKER_GENDER
df <- df_graphs %>% filter (STIMULUS =="B1-3") %>% 
  mutate(
    MAKER_GENDER = fct_rev(MAKER_GENDER)
  )
ggpiestats(data = df, x=MAKER_GENDER )

##GGPIESTATS MAKER_AGE
df <- df_graphs %>% filter (STIMULUS =="B1-3") %>% 
  mutate(
    MAKER_AGE = fct_rev(MAKER_AGE)
  )
ggpiestats(data = df, x=MAKER_AGE )


##GGPIESTATS MAKER_ID
df <- df_graphs %>% filter (STIMULUS =="B1-3") %>% 
  mutate(
    MAKER_ID = fct_rev(MAKER_ID)
  )
ggpiestats(data = df, x=MAKER_ID )


##DONUT WITH LESSR

library(lessR)

#MAKER_ID-DONUT
PieChart(MAKER_ID, data = df,
         fill = "reds",
         main = NULL)


#MAKER_GENDER-DONUT
PieChart(MAKER_GENDER, data = df,
         fill = "blues",
         main = NULL)


#MAKER_GENDER-DONUT
PieChart(MAKER_AGE, data = df,
         fill = "olives",
         main = NULL)


# View(paletteer::palettes_d_names)

```
## semantic differentials
```{r sd-b13, warning=FALSE}





##FILTER DATAFRAME
s = "B1-3" #stimulus code
df <- df_graphs %>% filter(STIMULUS == s)

questions = c("MAKER_POLITIC", "MAKER_ARGUE", "MAKER_SELF", "MAKER_ALIGN", "MAKER_TRUST")
# questions = ref_sd_questions
labels <- ref_labels %>% filter(row.names(ref_labels) %in% questions)

#### RAINCLOUD PLOT
  # setup dataframe 
  title <- ref_stimuli %>% filter(ID == s) %>% select(NAME) ##TODO IF NOT WORK ref_stim_id
  title <- paste0(title, " [",s,"]")
  df <- df_sd_questions_wide %>% select(1:6, QUESTION, all_of(s)) %>% 
    filter(!is.na(s)) %>%  
    mutate(value = get(s)) %>% 
    filter(QUESTION %in% questions)


  #RAINCLOUD PLOT
  # x <- 
    ggplot(df, aes(y = fct_rev(QUESTION), x = value)) +
  stat_slab(aes(thickness = after_stat(pdf*n)), scale = 0.7) +
  stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
  # facet_grid( .~ Distribution) +
  guides(
    # y = guide_axis_manual(labels = paste(levels(df$QUESTION),ref_labels$left)),
    y = guide_axis_manual(labels = rev(labels$left)),
    y.sec = guide_axis_manual(labels = rev(labels$right))
  ) +
  labs (title = title) +
  theme_minimal() 
   
  
  # rain_stimuli[[i]] <- x
  ggsave(plot = x, path="figs/_aggressive_american_flag", filename =paste0(s,"_rain.png"), units = c("in"), width = 10, height = 14  )

```



# B0-0 MILLENIAL PINK PLANTS
### GGBIVARIATE
```{r bivariate-demos-b00}
if(graph_render == TRUE){


### EXPLORE ALL QUESTIONS AS EXPLAINED BY DEMOGRAPHICS
df <- df_graphs %>% filter(STIMULUS=="B0-0")
predictors = df %>% select(Distribution, STIMULUS_CATEGORY,
                D_gender_collapsed, D_age, D_education, D_income,
                D_politicalParty, D_politicsFiscal, D_politicsSocial) %>% colnames()

questions = c(ref_sd_questions, ref_conf_questions, ref_cat_questions)

i=0
for (q in questions){
  i = i+1
  title <- paste(q)
  g <- ggbivariate(df, outcome = q, explanatory = predictors) + labs(
    title = paste0("B0-0 ",q, " as explained by demographic variables")
  )+ theme_minimal()
  ggsave(plot = g, path="figs/_millenial-pink-plants/bivariate/bivariate_demographics", filename =paste0("B0-0_",q,"_demo_ggbivariate.png"), units = c("in"), width = 10, height = 25)
}
rm(i,g)
#####################################################END




### EXPLORE ALL QUESTIONS AS EXPLAINED BY SD VARS
df <- df_graphs %>% filter(STIMULUS=="B0-0")
predictors = c(ref_sd_questions)
questions = c(ref_sd_questions, ref_conf_questions, ref_cat_questions)
i=0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  g <- ggbivariate(df, outcome = q, explanatory = predictors) + labs(
    title = paste0("B0-0 ",q, " as explained by SD variables")
  )+ theme_minimal()
  ggsave(plot = g, path="figs/_millenial-pink-plants/bivariate/bivariate_SD", filename =paste0("B0-0_",q,"_sd_ggbivariate.png"), units = c("in"), width = 10, height = 25)
}
rm(i,g )
#####################################################END



### EXPLORE ALL QUESTIONS AS EXPLAINED BY CONF VARS
df <- df_graphs %>% filter(STIMULUS=="B0-0")
predictors = c(ref_conf_questions)
questions = c(ref_sd_questions, ref_conf_questions, ref_cat_questions)
i=0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  g <- ggbivariate(df, outcome = q, explanatory = predictors) + labs(
    title = paste0("B0-0 ",q, " as explained by CONF variables")
  )+ theme_minimal()
  ggsave(plot = g, path="figs/_millenial-pink-plants/bivariate/bivariate_CONF", filename =paste0("B0-0_",q,"_conf_ggbivariate.png"), units = c("in"), width = 10, height = 25)
}
rm(i,g)
#####################################################END


### EXPLORE ALL QUESTIONS AS EXPLAINED BY CAT VARS
df <- df_graphs %>% filter(STIMULUS=="B0-0")
predictors = c(ref_cat_questions)
questions = c(ref_sd_questions, ref_conf_questions, ref_cat_questions)
i=0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  g <- ggbivariate(df, outcome = q, explanatory = predictors) + labs(
    title = paste0("B0-0 ",q, " as explained by CATEGORICAL variables")
  )+ theme_minimal()
  ggsave(plot = g, path="figs/_millenial-pink-plants/bivariate/bivariate_CAT", filename =paste0("B0-0_",q,"_cat_ggbivariate.png"), units = c("in"), width = 10, height = 25)
}
rm(i,g)
#####################################################END

}
```


## PAIRPLOTS

```{r boo-pairplots}

if(graph_render == TRUE){


#####################################################PAIRPLOT_SD
df <- df_graphs %>% filter(STIMULUS=="B0-0") %>% select(all_of(ref_sd_questions))
g <- ggpairs(df) 
ggsave(plot = g, path="figs/_millenial-pink-plants", filename =paste0("B00","_sd_pairplot.png"), units = c("in"), width = 20, height = 20  )
g <- ggduo(df)
ggsave(plot = g, path="figs/_millenial-pink-plants", filename =paste0("B00","_sd_duoplot.png"), units = c("in"), width = 20, height = 20  )

#####################################################PAIRPLOT_CAT
df <- df_graphs %>% filter(STIMULUS=="B0-0") %>% select(all_of(ref_cat_questions))
g <- ggpairs(df) 
ggsave(plot = g, path="figs/_millenial-pink-plants", filename =paste0("B00","_cat_pairplot.png"), units = c("in"), width = 20, height = 20  )
g <- ggduo(df)
ggsave(plot = g, path="figs/_millenial-pink-plants", filename =paste0("B00","_cat_duoplot.png"), units = c("in"), width = 20, height = 20  )


#####################################################PAIRPLOT_CONF
df <- df_graphs %>% filter(STIMULUS=="B0-0") %>% select(all_of(ref_conf_questions))
g <- ggpairs(df) 
ggsave(plot = g, path="figs/_millenial-pink-plants", filename =paste0("B00","_conf_pairplot.png"), units = c("in"), width = 20, height = 20  )
g <- ggduo(df)
ggsave(plot = g, path="figs/_millenial-pink-plants", filename =paste0("B00","_conf_duoplot.png"), units = c("in"), width = 20, height = 20  )

####################################################################################################
####################################################################################################






#####################################################PAIRPLOT_SD COLORED BY DEMO
predictors = df_graphs %>% select(Distribution, STIMULUS_CATEGORY,
                D_gender_collapsed, D_age, D_education, D_income,
                D_politicalParty) %>% colnames()

i=0
for (p in predictors){
  df <- df_graphs %>% filter(STIMULUS=="B0-0") %>% select(p, all_of(ref_sd_questions))
  g <- ggpairs(df, aes(color = get(p)))   
  ggsave(plot = g, path="figs/_millenial-pink-plants/colored_pairs", filename =paste0("B00_",p,"_sd_pairplot.png"), units = c("in"), width = 40, height = 40  )  
  g <- ggduo(df, aes(color = get(p)))   
  ggsave(plot = g, path="figs/_millenial-pink-plants/colored_duos", filename =paste0("B00_",p,"_sd_duoplot.png"), units = c("in"), width = 40, height = 40  )  
  
}
rm(i,g,df)
####################################################################################################



}

```

## MODELLING

### Modelling Trust

```{r}

df <- df_graphs %>% filter(STIMULUS == "B0-0") %>%
  mutate(
    flipped_data = abs(MAKER_DATA - 100),
    flipped_design = abs(MAKER_DESIGN -100),
    flipped_intent = abs(CHART_INTENT -100),
    flipped_self = abs(MAKER_SELF -100)
  ) %>% select(
    flipped_data:flipped_self, MAKER_ARGUE, MAKER_ALIGN, CHART_LIKE, CHART_BEAUTY, CHART_TRUST, MAKER_TRUST
  )


chart_m.1 <- lm(CHART_TRUST ~ CHART_BEAUTY, data = df )
summ(chart_m.1)

chart_m.2 <- lm(CHART_TRUST ~ MAKER_ALIGN , data = df )
summ(chart_m.2)


anova(chart_m.1, chart_m.2)
compare_performance(chart_m.1, chart_m.2, rank = TRUE)


m.1 <- lm(MAKER_TRUST ~ CHART_BEAUTY, data = df )
summ(m.1)

m.2 <- lm(MAKER_TRUST ~ MAKER_ALIGN , data = df )
summ(m.2)

anova(m.1, m.2)
compare_performance(chart_m.1, chart_m.2, m.1, m.2, rank = TRUE)


m.3 <- lm(CHART_TRUST ~ MAKER_TRUST + MAKER_ALIGN + CHART_BEAUTY , data = df )
summ(m.3)

m.4 <- lm(CHART_TRUST ~ MAKER_TRUST + MAKER_ALIGN + CHART_BEAUTY + flipped_intent, data = df )
summ(m.4)

m.5 <- lm(CHART_TRUST ~ MAKER_TRUST + MAKER_ALIGN + CHART_BEAUTY + flipped_intent + flipped_data, data = df )
summ(m.5)


m.6 <- lm(MAKER_TRUST ~ CHART_BEAUTY + MAKER_ALIGN + flipped_intent + flipped_data + flipped_design, data = df )
summ(m.6)
 

m.7 <- lm(CHART_TRUST ~ CHART_BEAUTY + MAKER_ALIGN + flipped_intent + flipped_data + flipped_design, data = df )
summ(m.7)

m <- lm(MAKER_TRUST ~ MAKER_ALIGN, data = df)
summ(m)

 
 compare_performance(m.1, m.2, m.3, m.4, m.5, m, rank = TRUE)
# 
# ## WHAT PREDICTS MAKER_TRUST?
# 
# 
# ## PLOT THE DATA 
# ggplot(df, aes(x = MAKER_ALIGN, y = MAKER_TRUST)) + 
#   geom_point() +
#   stat_smooth(method = "lm", 
#               formula = y ~ x, 
#               geom = "smooth") + 
#   labs(title = "MAKER ALIGNMENT PREDICTS TRUST?")+
#   theme_minimal()
# 
# 
# ## PLOT THE DATA 
# ggplot(df, aes(x = flipped_data, y = MAKER_TRUST)) + 
#   geom_point() +
#   stat_smooth(method = "lm", 
#               formula = y ~ x, 
#               geom = "smooth") + 
#   labs(title = "MAKER DATA PREDICTS TRUST?")+
#   theme_minimal()
# 
# 
# ## BUILD MODEL
# m.1 <- lm( MAKER_TRUST ~ MAKER_ALIGN, data = df)
# # summary(m.1)
# jtools::summ(m.1, confint = TRUE)
# # check_model(m.1)
# # report(m.1)
# 
# ## BUILD MODEL
# m.2 <- lm( MAKER_TRUST ~ MAKER_ALIGN + flipped_data, data = df)
# # summary(m.2)
# jtools::summ(m.2, confint = TRUE)
# # check_model(m.2)
# # report(m.2)
# 
# ## BUILD MODEL
# m.3 <- lm( MAKER_TRUST ~ MAKER_ALIGN + flipped_data + flipped_design , data = df)
# # summary(m.3)
# jtools::summ(m.3, confint = TRUE)
# # check_model(m.3)
# # report(m.3)
# 
# 
# ## BUILD MODEL
# m.4 <- lm( MAKER_TRUST ~ MAKER_ALIGN + flipped_data + flipped_design + MAKER_POLITIC, data = df)
# # summary(m.3)
# jtools::summ(m.4, confint = TRUE)
# # check_model(m.3)
# # report(m.3)
# 
# 
# 
#   
# compare_performance(m.1, m.2, m.3, m.4, m.B,  rank = TRUE)
# 
# 
# # effect_plot(m.2, pred=MAKER_DATA, rug = TRUE, plot.points = TRUE) + 
# #   xlim(0,100) + 
# #   ylim(0,100)
# 
# 
# 
# 
# df <- df_graphs %>% filter(STIMULUS != "B0-0") %>% 
#   select(PID, STIMULUS, 
#          MAKER_ID:MAKER_TRUST, CHART_LIKE:CHART_TRUST, 
#          D_politicsFiscal, D_politicsSocial)
# 
# m.pid <- lmer( MAKER_TRUST ~  (1 | PID) , data = df, REML = FALSE)
# m.stim <- lmer( MAKER_TRUST ~ (1|STIMULUS) , data = df, REML = FALSE)
# m.r <- lmer( MAKER_TRUST ~ (1 | PID) + (1|STIMULUS), data = df, REML = FALSE)
# 
# compare_performance (m.pid, m.stim, m.r, rank = TRUE)
# 
# 
# 
# m.1 <- update( m.r, .~. + CHART_BEAUTY)
# summ(m.1)
# 
# m.2 = update(m.1, . ~ . + CHART_LIKE)
# summ(m.2)
# 
# 
# m.3 = update(m.2, . ~ . + CHART_TRUST)
# summ(m.3)
# 
# 
# compare_performance(m.r, m.1, m.2, m.3, rank = TRUE)

```
### TODO COME BACK HERE Modelling Engagement

```{r B00-ENGAGEMENT}


# df <- df_graphs %>% filter(STIMULUS == "B0-0") %>%
#   mutate(
#     flipped_data = abs(MAKER_DATA - 100),
#     flipped_design = abs(MAKER_DESIGN -100),
#     flipped_intent = abs(CHART_INTENT -100),
#     flipped_self = abs(MAKER_SELF -100),
#   ) %>% select(
#     MAKER_ARGUE, MAKER_ALIGN, CHART_LIKE, CHART_BEAUTY,
#     flipped_data:flipped_self,  CHART_TRUST, MAKER_TRUST, 
#     Distribution, D_gender, D_education, D_politicalParty, 
#     D_politicsSocial, D_politicsFiscal,
#     MAKER_ID, MAKER_AGE, MAKER_GENDER, 
#   )


## left off here !!! 
## MAKE DATAFRAME OF ACTIONS WITH OTHER STUFF 
# df_g <- df_graphs %>% filter(STIMULUS == "B0-0")
# df_a <- df_actions %>% filter(STIMULUS == "B0-0")
# df_x <- df_a %>% inner_join(x=df_a, y=df_g, by="PID",
#                            relationship = "many-to-one",
#                            multiple = "last",
#                            keep = FALSE)
# rm(df_a, df_g)
# 
# 
# df <- df_x %>% filter(STIMULUS == "B0-0") %>%
#   mutate(
#     flipped_data = abs(MAKER_DATA - 100),
#     flipped_design = abs(MAKER_DESIGN -100),
#     flipped_intent = abs(CHART_INTENT -100),
#     flipped_self = abs(MAKER_SELF -100),
#   ) %>% select(
#     MAKER_ARGUE, MAKER_ALIGN, CHART_LIKE, CHART_BEAUTY,
#     flipped_data:flipped_self,  CHART_TRUST, MAKER_TRUST,
#     Distribution, D_gender, D_education, D_politicalParty,
#     D_politicsSocial, D_politicsFiscal,
#     MAKER_ID, MAKER_AGE, MAKER_GENDER,
#   )
# 


## PLOT DISTRIBUTION OF ENGAGEMENT 
# 
# (a <- ggbarstats( data = df, x = "REV_CHART_ACTION", y = "STIMULUS",
#                  legend.title = "ENGAGEMENT")  + 
#       scale_fill_paletteer_d("awtools::a_palette", direction = 1)+
#       labs( title = "Chart Engagement ", subtitle = "", x = "") )
#   
#         
# 
# (b <- grouped_ggbarstats( data = df_a, x = "REV_CHART_ACTION", y = "STIMULUS", 
#                     grouping.var = Distribution, 
#                     legend.title = "ENGAGEMENT",  
#                     ggplot.component = list(scale_fill_paletteer_d("awtools::a_palette", direction = 1))))
# 
# 
# 
# df <- df_a %>% mutate( REV_CHART_ACTION = fct_rev(CHART_ACTION))
# predictors = df_a %>% select(Distribution, PLATFORM, 
#                 D_gender, D_age, D_education, D_race, D_income, 
#                 D_politicalParty, D_politicsFiscal, D_politicsSocial) %>% colnames()
# 
# 
# 
# 
# 
# ## PLOT POTENTIAL BIVARIATE
# (g <- ggbivariate(df_a, outcome = "CHART_ACTION", explanatory = predictors) + 
#   scale_fill_paletteer_d("awtools::a_palette", direction = 1))
# 
# ggsave(plot = g, path="figs/modelling", filename =paste0("b00_engagement","_bivariatet.png"), units = c("in"), width = 15, height = 20  )
# 
# 
# ## PLOT EXPLANATIONS OF ENGAGEMENT
# 
# 
# 
# ##
# 
# ## Visualize Engagement with B00
# 
# # 
# # 
# # 
# # 
# # chart_m.1 <- lm(CHART_TRUST ~ CHART_BEAUTY, data = df )
# # summ(chart_m.1)
# # 
# # chart_m.2 <- lm(CHART_TRUST ~ MAKER_ALIGN , data = df )
# # summ(chart_m.2)
# # 
# # 
# # anova(chart_m.1, chart_m.2)
# # compare_performance(chart_m.1, chart_m.2, rank = TRUE)
# # 
# # 
# # m.1 <- lm(MAKER_TRUST ~ CHART_BEAUTY, data = df )
# # summ(m.1)
# # 
# # m.2 <- lm(MAKER_TRUST ~ MAKER_ALIGN , data = df )
# # summ(m.2)
# # 
# # anova(m.1, m.2)
# # compare_performance(chart_m.1, chart_m.2, m.1, m.2, rank = TRUE)
# # 
# # 
# # m.3 <- lm(CHART_TRUST ~ MAKER_TRUST + MAKER_ALIGN + CHART_BEAUTY , data = df )
# # summ(m.3)
# # 
# # m.4 <- lm(CHART_TRUST ~ MAKER_TRUST + MAKER_ALIGN + CHART_BEAUTY + flipped_intent, data = df )
# # summ(m.4)
# # 
# # m.5 <- lm(CHART_TRUST ~ MAKER_TRUST + MAKER_ALIGN + CHART_BEAUTY + flipped_intent + flipped_data, data = df )
# # summ(m.5)
# # 
# # 
# # m.6 <- lm(MAKER_TRUST ~ CHART_BEAUTY + MAKER_ALIGN + flipped_intent + flipped_data + flipped_design, data = df )
# # summ(m.6)
# #  
# # 
# # m.7 <- lm(CHART_TRUST ~ CHART_BEAUTY + MAKER_ALIGN + flipped_intent + flipped_data + flipped_design, data = df )
# # summ(m.7)
# # 
# # m <- lm(MAKER_TRUST ~ MAKER_ALIGN, data = df)
# # summ(m)
# # 
# #  
# #  compare_performance(m.1, m.2, m.3, m.4, m.5, m, rank = TRUE)
# # # 
# # ## WHAT PREDICTS MAKER_TRUST?
# # 
# # 
# # ## PLOT THE DATA 
# # ggplot(df, aes(x = MAKER_ALIGN, y = MAKER_TRUST)) + 
# #   geom_point() +
# #   stat_smooth(method = "lm", 
# #               formula = y ~ x, 
# #               geom = "smooth") + 
# #   labs(title = "MAKER ALIGNMENT PREDICTS TRUST?")+
# #   theme_minimal()
# # 
# # 
# # ## PLOT THE DATA 
# # ggplot(df, aes(x = flipped_data, y = MAKER_TRUST)) + 
# #   geom_point() +
# #   stat_smooth(method = "lm", 
# #               formula = y ~ x, 
# #               geom = "smooth") + 
# #   labs(title = "MAKER DATA PREDICTS TRUST?")+
# #   theme_minimal()
# # 
# # 
# # ## BUILD MODEL
# # m.1 <- lm( MAKER_TRUST ~ MAKER_ALIGN, data = df)
# # # summary(m.1)
# # jtools::summ(m.1, confint = TRUE)
# # # check_model(m.1)
# # # report(m.1)
# # 
# # ## BUILD MODEL
# # m.2 <- lm( MAKER_TRUST ~ MAKER_ALIGN + flipped_data, data = df)
# # # summary(m.2)
# # jtools::summ(m.2, confint = TRUE)
# # # check_model(m.2)
# # # report(m.2)
# # 
# # ## BUILD MODEL
# # m.3 <- lm( MAKER_TRUST ~ MAKER_ALIGN + flipped_data + flipped_design , data = df)
# # # summary(m.3)
# # jtools::summ(m.3, confint = TRUE)
# # # check_model(m.3)
# # # report(m.3)
# # 
# # 
# # ## BUILD MODEL
# # m.4 <- lm( MAKER_TRUST ~ MAKER_ALIGN + flipped_data + flipped_design + MAKER_POLITIC, data = df)
# # # summary(m.3)
# # jtools::summ(m.4, confint = TRUE)
# # # check_model(m.3)
# # # report(m.3)
# # 
# # 
# # 
# #   
# # compare_performance(m.1, m.2, m.3, m.4, m.B,  rank = TRUE)
# # 
# # 
# # # effect_plot(m.2, pred=MAKER_DATA, rug = TRUE, plot.points = TRUE) + 
# # #   xlim(0,100) + 
# # #   ylim(0,100)
# # 
# # 
# # 
# # 
# # df <- df_graphs %>% filter(STIMULUS != "B0-0") %>% 
# #   select(PID, STIMULUS, 
# #          MAKER_ID:MAKER_TRUST, CHART_LIKE:CHART_TRUST, 
# #          D_politicsFiscal, D_politicsSocial)
# # 
# # m.pid <- lmer( MAKER_TRUST ~  (1 | PID) , data = df, REML = FALSE)
# # m.stim <- lmer( MAKER_TRUST ~ (1|STIMULUS) , data = df, REML = FALSE)
# # m.r <- lmer( MAKER_TRUST ~ (1 | PID) + (1|STIMULUS), data = df, REML = FALSE)
# # 
# # compare_performance (m.pid, m.stim, m.r, rank = TRUE)
# # 
# # 
# # 
# # m.1 <- update( m.r, .~. + CHART_BEAUTY)
# # summ(m.1)
# # 
# # m.2 = update(m.1, . ~ . + CHART_LIKE)
# # summ(m.2)
# # 
# # 
# # m.3 = update(m.2, . ~ . + CHART_TRUST)
# # summ(m.3)
# # 
# # 
# # compare_performance(m.r, m.1, m.2, m.3, rank = TRUE)

```


```{r IXN-BOO}

df <- df_graphs_full %>% 
  filter(STIMULUS== "B0-0") 

 p <- ggplot(df, aes(x = MAKER_POLITIC, y = MAKER_CONF,
          color = MAKER_ID ,
          text = paste0("MAKER-DETAIL: ",MAKER_DETAIL, "<br>","ID: ", PID, "MAKER_EXPLAIN", MAKER_EXPLAIN)))+
      scale_color_viridis(discrete=TRUE, option="viridis")  +
      geom_point(size=0.5) +
      xlim(0,100)+
      ylim(0,100)+
      facet_grid(D_politicalParty ~ MAKER_ID) +
      theme_minimal() +
      labs(
        title = "B0-0 | MAKER Identification, Politics and Confidence",
        subtitle = "\n by Participant Confidence and Political Party",
        x = "MAKER POLITICS",
        y = "MAKER ID CONFIDENCE"
      )


ggplotly(p)
  
```


### On Confidence

```{r}


# df <- df_confidence_long %>% filter(QUESTION %nin% c("CONF", "SDIFF")) ##AVERAGE CONFIDENCE

df <- df_graphs_full %>% filter(STIMULUS== "B0-0")


ggplot(df, aes(x = MAKER_CONF, y = MAKER_TRUST, color = MAKER_ID)) + 
  geom_point() +
  scale_color_viridis(discrete=TRUE, option="viridis")  + 
  facet_grid(BLOCK ~ STIMULUS_CATEGORY) +
  theme_minimal() + 
  easy_remove_legend() 
  


ggplot(df, aes(x = MAKER_POLITIC, y = MAKER_TRUST, color = MAKER_ID)) + 
  geom_point() +
  scale_color_viridis(discrete=TRUE, option="viridis")  + 
  facet_grid(BLOCK ~ STIMULUS_CATEGORY) +
  theme_minimal() + 
  easy_remove_legend() 



```










# EDA

##  PAIR PLOTS

### B0-0 MILLENIAL PINK PLANTS 

```{r B00_MAKERID, message=FALSE}

#FILTER DATAFRAME
df <- df_graphs_full %>%
  filter(STIMULUS== "B0-0") %>%
  select(
    Distribution,  D_politicalParty,
    # D_gender, D_race, D_education, D_income, D_age,
    # ENCOUNTER,
    MAKER_ID,
    D_politicsSocial, D_politicsFiscal,
    MAKER_DESIGN, MAKER_DATA, MAKER_CONF, MAKER_ALIGN, MAKER_TRUST, CHART_TRUST
    # :MAKER_TRUST,
    # TOOL_CONF,CHART_LIKE:CHART_TRUST
)

# g <- ggpairs(df, color=MAKER_ID)
# ggsave(plot = g, path="figs/pairplots", filename =paste0("B0-0","_pairplot.svg"), units = c("in"), width = 20, height = 20  )
# ggplotly(g)




(boo_pair <- ggpairs(df, aes(color= MAKER_ID)) +
    scale_color_viridis(discrete=TRUE, option="viridis")+
    scale_fill_viridis(discrete=TRUE, option="viridis") +
    theme_minimal()
  )


(boo_duo <- ggduo(df, aes(color= Distribution)) +
    scale_color_viridis(discrete=TRUE, option="viridis")+
    scale_fill_viridis(discrete=TRUE, option="viridis") +
    theme_minimal()
  )



ggplotly(boo_duo) #surprisingly works! but not helpful

```

### CATEGORIES-MAKER
```{r}

df <- df_graphs %>% select(
  STIMULUS_CATEGORY, MAKER_ID, MAKER_DESIGN, MAKER_DATA, MAKER_POLITIC, MAKER_ARGUE, MAKER_ALIGN, MAKER_TRUST, CHART_TRUST, CHART_BEAUTY
)


#maker pair plot 
x <- ggduo(df, aes(color = STIMULUS_CATEGORY))
ggsave(plot = x, path="figs/pairplots", filename =paste0("maker_category","_duoplot.png"), units = c("in"), width = 20, height = 20  )

#maker pair plot 
x <- ggpairs(df, aes(color = STIMULUS_CATEGORY))
ggsave(plot = x, path="figs/pairplots", filename =paste0("maker_category","_pairplot.png"), units = c("in"), width = 20, height = 20  )

```


### CATEGORIES-CHART
```{r}

df <- df_graphs %>% select(
  STIMULUS_CATEGORY, MAKER_ID, CHART_LIKE, CHART_BEAUTY, CHART_INTENT, CHART_TRUST, MAKER_TRUST
)


#maker pair plot 
x <- ggduo(df, aes(color = STIMULUS_CATEGORY))
ggsave(plot = x, path="figs/pairplots", filename =paste0("chart_category","_duoplot.png"), units = c("in"), width = 20, height = 20  )

#maker pair plot 
x <- ggpairs(df, aes(color = STIMULUS_CATEGORY))
ggsave(plot = x, path="figs/pairplots", filename =paste0("chart_category","_pairplot.png"), units = c("in"), width = 20, height = 20  )

```



### ALL NUMERIC
```{r}

df <- df_graphs %>% select(STIMULUS_CATEGORY, where(is.numeric)) %>% 
  select(-duration.min)


#maker pair plot 
x <- ggscatmat(df, color = "STIMULUS_CATEGORY")
ggsave(plot = x, path="figs/pairplots", filename =paste0("category","_scaplot.png"), units = c("in"), width = 20, height = 20  )



```



# INTERACTIVE GRAPHS


### WIP IXN Maker ID & Politics
```{r PLOTLY}

#SETUP LISTS 
stim <- ref_stimuli##TODO IF NOT WORK ref_stim_id
plots_maker_politics <- htmltools::tagList()

### MAKE PLOTS 
# LOOP THROUGH STIMULI
i = 0
for (s in stim){
  i = i+1 #iterator hack
  
  d <- df_graphs_full %>% filter(STIMULUS == s) %>% select(PID, STIMULUS, 
                                                               MAKER_ID, MAKER_DETAIL, MAKER_CONF, MAKER_POLITIC,
                                                               D_politicalParty, D_politicsSocial, D_politicsFiscal) 
  p <- ggplot(d, aes(x = MAKER_POLITIC, y = MAKER_CONF,
          color = MAKER_ID ,
          text = paste0("MAKER-DETAIL: ",MAKER_DETAIL, "<br>","ID: ", PID)))+
      geom_point() +
      xlim(0,100)+
      ylim(0,100)+
      facet_grid(MAKER_ID  ~ D_politicalParty) +
      theme_minimal() +
      labs(
        title = paste(s," | ", "MAKER Identification, Politics and Confidence, by Participant Confidence and Political Affiliation"),
        x = "MAKER POLITICS",
        y = "MAKER CONFIDENCE"
      )

  
  plots_maker_politics[[i]] <- ggplotly(p)
  
}

names(plots_maker_politics) <- ref_stimuli ##TODO IF NOT WORK ref_stim_id


#works in console but not render 
### PRINT PLOTS
# for (s in stim){
#   print(plots_maker_politics[[s]])
# }


# ggplotly(p) #works for single

plots_maker_politics
```


# WIP QDA ANALYSIS

## MAKER ID DETAIL 

```{r CODED-MAKER-ID-DETAIL}

# df <- df_graphs_coded %>% select( ID.Prolific, STIMULUS, BLOCK, STIMULUS_CATEGORY, MAKER_ID, MAKER_DETAIL, CODE_M_ID_SPECIFIC) %>% 
#   separate_longer_delim(
#     cols = CODE_M_ID_SPECIFIC,
#     delim = ","
#   ) %>% filter(
#     CODE_M_ID_SPECIFIC %nin% c("x", "X","example")
#   ) %>% mutate(
#     CODED_MAKER = str_trim(CODE_M_ID_SPECIFIC, side="left"),
#     CODED_MAKER = str_to_upper(CODED_MAKER),
#     CODED_MAKER = factor(CODED_MAKER, levels = c( "NYT",
#                                                   "WASHINGTON POST" ,
#                                                   "USA TODAY" ,
#                                                   "THE ECONOMIST" ,
#                                                   "WSJ",
#                                                   "POPULAR SCIENCE" ,
#                                                   "TIME",
#                                                   "NPR",
#                                                   "PBS",
#                                                   "ASSOCIATED PRESS"  ,
#                                                   "BBC",
#                                                   "CBS NEWS"  ,
#                                                   "ABC NEWS"  ,
#                                                   "NBC",
#                                                   "CNN",
#                                                   "FOX NEWS"  ,
#                                                   "BUZZFEED",
#                                                   "VOX",
#                                                   "VICE",
#                                                   "HUFFINGTON POST" ,
#                                                   "US DOD"  ,
#                                                   "US BUREAU OF ECONOMIC ANALYSIS",
#                                                   "US DOE"  ,
#                                                   "US CDC"  ,
#                                                   "MINISTRY OF HEALTH"  ,
#                                                   "EPA",
#                                                   "NOAA",
#                                                   "NATIONAL WEATHER SERVICE"  ,
#                                                   "WHO",
#                                                   "UN",
#                                                   "THE NATURE CONSERVANCY"  ,
#                                                   "GREENPEACE",
#                                                   "LEAF",
#                                                   "HARVARD",
#                                                   "COLUMBIA UNIVERSITY" ,
#                                                   "IAA",
#                                                   "IBM",
#                                                   "MICROSOFT",
#                                                   "GOLDMAN SACHS" ,
#                                                   "GMC",
#                                                   "TESLA",
#                                                   "GREEN PARTY OF AMERICA"  ,
#                                                   "THE DEMOCRATIC PARTY"  ,
#                                                   "THE REPUBLICAN PARTY")),
#     STIM = factor(STIMULUS, levels = c(
#       "B1-1",  "B2-1", "B3-1", "B4-1", "B5-1", "B6-1",
#       "B1-2",  "B2-2", "B3-2", "B4-2", "B5-2", "B6-2",
#       "B1-3", "B2-3", "B3-3", "B4-3", "B5-3", "B6-3",
#       "B1-4","B2-4" ,"B3-4" ,"B4-4" ,"B5-4" ,"B6-4", "B0-0"
#     ))
#   ) 
# 
# 
# 
# ggplot(df,  aes(x = MAKER_ID, fill = CODED_MAKER )) + 
#   geom_bar(position = "stack") +
#   facet_grid( rows = vars(BLOCK), cols = vars(fct_rev(STIMULUS_CATEGORY))) + 
#   theme_minimal() + 
#   labs(title = "Specific makers identified by stimulus")
# 
#                           
# ggplot(df,  aes(x = STIMULUS, fill = CODED_MAKER )) + 
#   geom_bar(position = "stack") + 
#   theme_minimal()
# 
# 
# ggplot(df,  aes(x = STIMULUS, fill = CODED_MAKER )) + 
#   geom_bar(position = "stack") + 
#   facet_wrap(~CODED_MAKER) + 
#   theme_minimal() +
#   easy_remove_x_axis() +
#   easy_remove_legend()
# 
#   
# ggplot(df,  aes(x = CODE_M_ID_SPECIFIC, fill = STIM, )) + 
#   geom_bar(position = "stack") + 
#   coord_flip() + 
#   theme_minimal() 
#   
  
      

```




# MODELLING






```{r, message=FALSE}

##STATSPLOT
# grouped_ggwithinstats(
#   data  = df_graphs,
#   x     = STIMULUS,
#   y     = CHART_TRUST,
#   grouping.var = ID.Study
# ) 

# grouped_ggscatterstats(
#   data = df_graphs, ## data frame from which variables are taken
#   x = CHART_BEAUTY, ## predictor/independent variable
#   y = CHART_TRUST, ## dependent variable
#   grouping.var = ID.Study,
#   xlab = "CHART BEAUTY", ## label for the x-axis
#   ylab = "CHART TRUST", ## label for the y-axis
#   # label.expression = rating < 5 & budget > 100, ## expression for deciding which points to label
#   point.label.args = list(alpha = 0.7, size = 4, color = "grey50"),
#   xfill = "#CC79A7", ## fill for marginals on the x-axis
#   yfill = "#009E73" ## fill for marginals on the y-axis
#   # title = "CHART TRUST (VS) MAKER TRUST",
#   # caption = ""
# )
# 
# gf_point( data = df_graphs, CHART_TRUST~MAKER_TRUST, color = ~STIMULUS) %>% gf_facet_wrap(~STIMULUS)
# 
# 
# grouped_ggscatterstats(
#   data = df_graphs, ## data frame from which variables are taken
#   x = MAKER_TRUST, ## predictor/independent variable
#   y = CHART_TRUST, ## dependent variable
#   grouping.var = ID.Study,
#   xlab = "MAKER TRUST", ## label for the x-axis
#   ylab = "CHART TRUST", ## label for the y-axis
#   # label.expression = rating < 5 & budget > 100, ## expression for deciding which points to label
#   point.label.args = list(alpha = 0.7, size = 4, color = "grey50"),
#   xfill = "#CC79A7", ## fill for marginals on the x-axis
#   yfill = "#009E73" ## fill for marginals on the y-axis
#   # title = "CHART TRUST (VS) MAKER TRUST",
#   # caption = ""
# )
# 
# gf_point( data = df_graphs, MAKER_TRUST~CHART_TRUST, color = ~STIMULUS) %>% gf_facet_wrap(~STIMULUS)
# 
# 
# 
# grouped_ggscatterstats(
#   data = df_graphs, ## data frame from which variables are taken
#   x = CHART_BEAUTY, ## predictor/independent variable
#   y = MAKER_ALIGN, ## dependent variable
#   grouping.var = ID.Study,
#   xlab = "CHART BEAUTY", ## label for the x-axis
#   ylab = "MAKER ALIGN", ## label for the y-axis
#   # label.expression = rating < 5 & budget > 100, ## expression for deciding which points to label
#   point.label.args = list(alpha = 0.7, size = 4, color = "grey50"),
#   xfill = "#CC79A7", ## fill for marginals on the x-axis
#   yfill = "#009E73" ## fill for marginals on the y-axis
#   # title = "CHART TRUST (VS) MAKER TRUST",
#   # caption = ""
# )
# 
# 
# gf_point( data = df_graphs, MAKER_ALIGN~CHART_BEAUTY, color = ~STIMULUS) %>% gf_facet_wrap(~STIMULUS)
# 
# 
# 
# 
# 
# 
# ggscatterstats(
#   data = df_graphs %>% filter(STIMULUS=="B0-0"), ## data frame from which variables are taken
#   x = CHART_BEAUTY, ## predictor/independent variable
#   y = MAKER_TRUST, ## dependent variable
#   xlab = "CHART BEAUTY", ## label for the x-axis
#   ylab = "MAKER TRUST", ## label for the y-axis
#   # label.expression = rating < 5 & budget > 100, ## expression for deciding which points to label
#   point.label.args = list(alpha = 0.7, size = 4, color = "grey50"),
#   xfill = "#CC79A7", ## fill for marginals on the x-axis
#   yfill = "#009E73" ## fill for marginals on the y-axis
#   # title = "CHART TRUST (VS) MAKER TRUST",
#   # caption = ""
# )
# 
# gf_point( data = df_graphs %>% filter(STIMULUS=="B0-0"), CHART_TRUST~CHART_BEAUTY, color = ~STIMULUS) %>% gf_facet_wrap(~STIMULUS)
# 
# gf_point( data = df_graphs %>% filter(STIMULUS=="B0-0"), MAKER_TRUST~CHART_BEAUTY, color = ~STIMULUS) %>% gf_facet_wrap(~STIMULUS)


```

```{r}
# 
# 
# #TODO CENTERING AND NORMALIZING
# 
# ### little model
# df <- df_graphs %>% filter(STIMULUS == "B0-0")
# m <- lm( CHART_TRUST ~ CHART_BEAUTY,data = df)
# summary(m)
# ggnostic(m) #GGALLY MODEL CHECKS
# check_model(m) #EASY STATS MODEL CHECKS 
# 
# report(m)
```

```{r}
### MORE COMPLEX MODEL
# df <- df_graphs %>% filter(STIMULUS != "B0-0")
# m1 <- lmer(CHART_TRUST ~ CHART_BEAUTY + (1|ID.Qualtrics), data = df)
# m2 <- lmer(CHART_TRUST ~ CHART_BEAUTY + (1|STIMULUS), data = df)
# m3 <- lmer(CHART_TRUST ~ CHART_BEAUTY + (1 | STIMULUS) + (1 | ID.Qualtrics), data = df)
# summary(m1)
# summary(m2)
# summary(m3)
# compare_parameters(m1,m2,m3)
# compare_performance(m1,m2,m3, rank = TRUE)
# 
# 
# m <- lmer(CHART_TRUST ~ CHART_BEAUTY + MAKER_TRUST + (1 | STIMULUS) ,  data = df)
# mi <- lmer(CHART_TRUST ~ CHART_BEAUTY * MAKER_TRUST + (1 | STIMULUS) , data = df)
# summary(m)
# summary(mi)
# 
# compare_performance(m3,m,mi, rank = TRUE)
# 
# report(m)
#todo see https://yury-zablotski.netlify.app/post/mixed-effects-models-2/ about fitting with ML vs REML for model comparison 
```

```{r}
# #TODO WALK THROUGH THIS 
# #https://yury-zablotski.netlify.app/post/mixed-models/#multiple-random-slope-model
# 
# #load example data
# data("sleepstudy")
# 
# #fit the model
# m_slp <- lmer(Reaction ~ Days + (Days | Subject), sleepstudy)
# 
# #the next line put all the estimated intercept and slope per subject into a dataframe
# reaction_slp <- as.data.frame(t(apply(ranef(m_slp)$Subject, 1,function(x) fixef(m_slp) + x)))
# 
# #to get the predicted regression lines we need one further step, writing the linear equation: Intercept + Slope*Days with different coefficient for each subject
# pred_slp <- melt(apply(reaction_slp,1,function(x) x[1] + x[2]*0:9), value.name = "Reaction")
# 
# #some re-formatting for the plot
# names(pred_slp)[1:2] <- c("Days","Subject")
# pred_slp$Days <- pred_slp$Days - 1
# pred_slp$Subject <- as.factor(pred_slp$Subject)
# 
# #plot with actual data 
# ggplot(pred_slp,aes(x=Days,y=Reaction,color=Subject))+
#   geom_line()+
#   geom_point(data=sleepstudy,aes(x=Days,y=Reaction))+
#   facet_wrap(~Subject,nrow=3)

```



# GENERATE SEMANTIC DIFFERENTIAL GRAPHS

NOTE: the following blocks run if the `graph_render` var is set to `TRUE` in the header block. Graphs are generated (takes a long time) and written to the figs folder. Only do this data are are added or excluded 

## ALL QUESTIONS

### MASTER — ALL STIMULI

```{r ALL-Q-COLLAPSED}

##ONLY RENDER GRAPHS IF SET TO TRUE
if(graph_render == TRUE){


  
  plot_sd = function (data, column, type, facet, facet_by, boxplot) {

  ggplot(df, aes(y = .data[[column]], x="")) +
    {if(boxplot) geom_boxplot(width = 0.5) } +
    geom_jitter(width = 0.1, alpha=0.3, {if(facet) aes(color=.data[[facet_by]])}) +
    {if(facet) facet_grid(.data[[facet_by]] ~ .)} +
    scale_y_continuous(limits=c(-1,101)) +
    labs(x="", y="") +
    coord_flip()  +
    {if(type == "S")
      guides(
        y = guide_axis_manual(labels = ref_labels[column,"left"]),
        y.sec = guide_axis_manual(labels = ref_labels[column,"right"])
      )} +
    {if(type == "Q")
      guides(
        y = guide_axis_manual(labels = ref_labels[q,"left"]),
        y.sec = guide_axis_manual(labels = ref_labels[q,"right"])
      )} +
  theme_minimal()  +
     labs (
       caption = column
     ) + easy_remove_legend()
  }
  
#################### ALL QUESTIONS across ALL STIMULUS #####################

  df <- df_graphs 

  #subset data cols 
  cols <- df %>% select( all_of(ref_sd_questions))
  plots <- as.list(lapply(colnames(cols), plot_sd, data = df, type ="S", facet = FALSE, boxplot=TRUE))
  
  #aggregate q plots into one for stimulus 
  plot_master_questions <- plots[[1]] / plots[[2]] / plots[[3]] / plots[[4]] / plots[[5]] / plots[[6]] / plots[[7]] /
   plots[[8]] /plots[[9]] /plots[[10]] /plots[[11]] + 
   plot_annotation(
     title = "ALL STIMULI",
     subtitle =""
   )
  
  ggsave(plot = plot_master_questions, path="figs/_master", filename =paste0("combined_stimuli","_box.png"), units = c("in"), width = 10, height = 14  )
  
  
  #### RAINCLOUD PLOT#############################################################################
  # setup dataframe 
  df <- df_sd_questions_long %>% select(1:8, QUESTION, value) 

  #RAINCLOUD PLOT
  x <- ggplot(df, aes(y = fct_rev(QUESTION), x = value, fill = fct_rev(QUESTION))) +
  stat_slab(aes(thickness = after_stat(pdf*n)), scale = 0.7) +
  stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
  guides(
    # y = guide_axis_manual(labels = paste(levels(df$QUESTION),ref_labels$left)),
    y = guide_axis_manual(labels = rev(ref_labels$left)),
    y.sec = guide_axis_manual(labels = rev(ref_labels$right))
  ) + 
  labs (title = "ALL STIMULI") +
  theme_minimal() 
   
  
  ggsave(plot = x, path="figs/_master", filename =paste0("combined_stimuli","_rain.png"), units = c("in"), width = 10, height = 14  )


  
  
  #### DENSITY RIDGES#############################################################################
  # setup dataframe 
  
  magic_colors = list(
  amy_gradient =  c("#ac57aa", "#9e5fa4", "#90689f", "#827099", "#747894", "#66818e", "#578988", "#499183", "#3b997d", "#2da278", "#1faa72"),
  my_favourite_colours = c("#702963", "#637029",    "#296370")
)
  
  
  magic_palettes = function(name, n, all_palettes = magic_colors, type = c("discrete", "continuous")) {
  palette = all_palettes[[name]]
  if (missing(n)) {
    n = length(palette)
  }
  type = match.arg(type)
  out = switch(type,
               continuous = grDevices::colorRampPalette(palette)(n),
               discrete = palette[1:n]
  )
  structure(out, name = name, class = "palette")
}
  

  
  df <- df_sd_questions_long %>% select(1:8, QUESTION, value) 
  
  
 (x <-  ggplot(df, aes(x = value, y = fct_rev(QUESTION), fill = fct_rev(QUESTION))) +
    geom_density_ridges(scale = 1.5,quantile_lines = TRUE, alpha = 0.75) + 
    # scale_fill_paletteer_d("colorBlindness::SteppedSequential5Steps")+ #don't hate this
    # scale_fill_paletteer_d("dichromat::SteppedSequential_5", direction = 1)+  #don't hate this
    # scale_fill_paletteer_d("ggthemes::Hue_Circle", direction = 1)+  #LOVE THIS
    # scale_fill_paletteer_d("ggthemes::Classic_Cyclic", direction = 1)+  #LOVE THIS
    ggplot2::scale_fill_manual(values = magic_palettes("amy_gradient"))+
    theme_minimal() +
    guides(
    # y = guide_axis_manual(labels = paste(levels(df$QUESTION),ref_labels$left)),
    # y = guide_axis_manual(labels = paste(rev(levels(df$QUESTION)))),
    y = guide_axis_manual(labels = rev(ref_labels$left)),
    y.sec = guide_axis_manual(labels = rev(ref_labels$right))
  ) + labs(
    title = "ALL STIMULI — SD questions"
  ))
  
  ggsave(plot = x, path="figs/_master", filename =paste0("combined_stimuli","_ridges.png"), units = c("in"), width = 10, height = 14  )

  
  
}
  






```



### ALL Q BY STIMULUS

```{r ALL-Q-BY-STIMULUS}

##ONLY RENDER GRAPHS IF SET TO TRUE
if(graph_render == TRUE){


#################### ALL QUESTIONS AT STIMULUS #####################
# ONE PLOT FOR EACH STIMULUS WITH ALL QUESTIONS

#set stimuli to be graphed 
stimuli <- ref_stimuli #created in wrangling block ##TODO IF NOT WORK ref_stim_id
# stimili <- c("B0-0","B2-1" ,"B2-2", "B2-3", "B2-4")

box_stimuli <- list()
rain_stimuli <- list()
i = 0
for (s in stimuli){
  i = i+1
  
  # setup dataframe 
  title <- ref_stimuli %>% filter(ID == s) %>% select(NAME)  ##TODO IF NOT WORK ref_stim_id
  title <- paste(s,"|",title)
  df <- df_graphs %>% filter(STIMULUS== s)

  #subset data cols 
  cols <- df %>% select( all_of(ref_sd_questions))
  plots <- as.list(lapply(colnames(cols), plot_sd, data = df, type ="S", facet = FALSE, boxplot=TRUE))

  #aggregate q plots into one for stimulus 
  x <- plots[[1]] / plots[[2]] / plots[[3]] / plots[[4]] / plots[[5]] / plots[[6]] / plots[[7]] /
   plots[[8]] /plots[[9]] /plots[[10]] /plots[[11]] + 
   plot_annotation(
     title = title,
     subtitle =""
   )
  
  box_stimuli[[i]] <- x
  ggsave(plot = x, path="figs/all_q_by_stimulus", filename =paste0(s,"_box.png"), units = c("in"), width = 10, height = 14  )
  
  
  #### RAINCLOUD PLOT
  # setup dataframe 
  title <- ref_stimuli %>% filter(ID == s) %>% select(NAME) ##TODO IF NOT WORK ref_stim_id
  title <- paste(s,"|",title)
  df <- df_sd_questions_wide %>% select(1:6, QUESTION, all_of(s)) %>% filter(!is.na(s)) %>%  mutate(value = get(s))


  #RAINCLOUD PLOT
  x <- ggplot(df, aes(y = fct_rev(QUESTION), x = value, fill = fct_rev(QUESTION))) +
  stat_slab(aes(thickness = after_stat(pdf*n)), scale = 0.7) +
  stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
  guides(
    # y = guide_axis_manual(labels = paste(levels(df$QUESTION),ref_labels$left)),
    y = guide_axis_manual(labels = rev(ref_labels$left)),
    y.sec = guide_axis_manual(labels = rev(ref_labels$right))
  ) + 
  labs (title = title) +
  theme_minimal() 
   
  
  rain_stimuli[[i]] <- x
  ggsave(plot = x, path="figs/all_q_by_stimulus", filename =paste0(s,"_rain.png"), units = c("in"), width = 10, height = 14  )
  
  
  
}

#GIVE NAMES TO LIST
#NOW CAN ACCESS plots by plots_stimulus$`B1-1`
#ALSO plots_stimulus$`B1-1`[[1]]
names(box_stimuli) <- stimuli
names(rain_stimuli) <- stimuli
rm(x, i, plots)

#############################################################################
} 

```



### ALL Q BY CATEGORY

```{r ALL-Q-BY-CATEGORY}

##ONLY RENDER GRAPHS IF SET TO TRUE
if(graph_render == TRUE){

#################### ALL QUESTIONS AT CATEGORY #####################
# ONE PLOT FOR EACH CATEGORY WITH ALL QUESTIONS

#set questions to be graphed 
categories <- unique(df_graphs$STIMULUS_CATEGORY)#created in wrangling block
box_category <- list()
rain_category <- list()

i = 0
for (c in categories){
  i = i+1

  # setup dataframe
  title <- paste("STIMULUS CATEGORY ", c)
  df <- df_graphs %>% filter(STIMULUS_CATEGORY == c)
  
  #subset data cols
  cols <- df %>% select( all_of(ref_sd_questions))
  plots <- as.list(lapply(colnames(cols), plot_sd, data = df, type = "S", facet = FALSE, boxplot=TRUE))
  
  #aggregate stimulus plots into block for question
  x <- plots[[1]] / plots[[2]]  / plots[[3]] / plots[[4]] / plots[[5]] / plots[[6]] / plots[[7]] /
        plots[[8]] /plots[[9]] /plots[[10]] /plots[[11]] +
      plot_annotation(
        title = title,
       subtitle =""
      )

  box_category[[i]] <- x
  ggsave(plot = x, path="figs/all_q_by_category", filename =paste0(c,"_box.png"), units = c("in"), width = 10, height = 26)
  
  
  
  
  #### RAINCLOUD PLOT
  # setup dataframe 
  title <- paste("STIMULUS CATEGORY ", c)
  df <- df_sd_questions_long %>% filter(STIMULUS_CATEGORY == c) %>% select(STIMULUS_CATEGORY, QUESTION, value, PID, Assigned.Block) 
  
  #RAINCLOUD PLOT
  x <- ggplot(df, aes(y = fct_rev(QUESTION), x = value, fill = fct_rev(QUESTION))) +
  stat_slab(normalize="groups", trim = TRUE, scale = 0.7) +
  stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
  guides(
    y = guide_axis_manual(labels = paste(rev(levels(df$QUESTION)),rev(ref_labels$left))),
    y = guide_axis_manual(labels = rev(ref_labels$left)),
    y.sec = guide_axis_manual(labels = rev(ref_labels$right))
  ) +
  labs (title = title) +
  theme_minimal() 
   
  
  rain_category[[i]] <- x
  ggsave(plot = x, path="figs/all_q_by_category", filename =paste0(c,"_rain.png"), units = c("in"), width = 10, height = 26  )
  
  
}  

#GIVE NAMES TO LIST
#NOW CAN ACCESS plots by plots_category$A
#ALSO plots_category$A[[1]]
names(box_category) <- categories
names(rain_category) <- categories
rm(x, i, plots)

}

```

## BY QUESTION

### Q for ALL STIMULI

```{r Q-FOR-ALL-STIMULI}

##ONLY RENDER GRAPHS IF SET TO TRUE
if(graph_render == TRUE){

####################CREATE SD PLOTS FOR EACH QUESTION#####################

#set questions to be graphed 
questions <- ref_sd_questions  #created in wrangling block
box_s_question <- list()
rain_s_question <- list()
i = 0
for (q in questions){
  i = i+1
  
  # setup dataframe 
  title <- paste(q)
  df <- df_sd_questions_wide %>% filter(QUESTION == q)

  #subset data cols 
  c <- df %>% select( all_of(ref_stimuli))##TODO IF NOT WORK ref_stim_id
  plots <- as.list(lapply(colnames(c), plot_sd, data = df, type = "Q", facet = FALSE, boxplot=TRUE))
  
  #aggregate stimulus plots into block for question
  x <- plots[[1]] / plots[[2]]  / plots[[3]] / plots[[4]] / plots[[5]] / plots[[6]] / plots[[7]] /
        plots[[8]] /plots[[9]] /plots[[10]] /plots[[11]] /  plots[[12]] / plots[[13]] / plots[[14]] / 
        plots[[15]] /plots[[16]] /plots[[17]] /plots[[18]] /  plots[[19]] / plots[[20]] / plots[[21]] /
        plots[[22]] /plots[[23]] /plots[[24]] /plots[[25]] + 
      plot_annotation(
        title = title,
       subtitle =""
      )
  box_s_question[[i]] <- x 
  ggsave(plot = x, path="figs/by_q_for_all_stimuli", filename =paste0(q,"_box.png"), units = c("in"), width = 10, height = 26)

  
  
  
  ############# RAINCLOUD
  # setup dataframe 
  title <- paste(q)
  df <- df_sd_questions_long %>% filter(QUESTION ==q)
    #select(1:6, QUESTION, all_of(s)) %>% filter(!is.na(s)) %>%  mutate(value = get(s))
  left <- ref_labels[q,]$left
  right <- ref_labels[q,]$right

  #RAINCLOUD PLOT
  x <- ggplot(df, aes(y = fct_rev(STIMULUS) , x = value, fill = fct_rev(STIMULUS))) +
      stat_slab(normalize="groups", scale = 0.7) +
      stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
  guides(
    y = guide_axis_manual(labels = left),
    y.sec = guide_axis_manual(labels = right)
  ) +
  labs (title = title) +
  theme_minimal() 
   
  
  rain_s_question[[i]] <- x
  ggsave(plot = x, path="figs/by_q_for_all_stimuli", filename =paste0(q,"_rain.png"), units = c("in"), width = 10, height = 14  )
  

  
}

#GIVE NAMES TO LIST
#NOW CAN ACCESS plots by plots_s_question$MAKER_DESIGN
#ALSO plots_s_question$MAKER_DESIGN[[1]]
names(box_s_question) <- questions
names(rain_s_question) <- questions
rm(x, i, plots, left, right)

#############################################################################

}
```

### Q for ALL CATEGORIES

```{r Q-FOR-ALL-CATEGORIES}

##ONLY RENDER GRAPHS IF SET TO TRUE
if(graph_render == TRUE){
  
####################SD PLOTS QUESTION BY CATEGORY #####################

#set grouping column 
g = "STIMULUS_CATEGORY" #string name of column to group by 

#set questions to be graphed 
questions <- ref_sd_questions#created in wrangling block
box_c_question <- list()
rain_c_question <- list()
i = 0
for (q in questions){
  i = i+1
  left <-   ref_labels[q,]$left
  right <-  ref_labels[q,]$right
  
  # setup dataframe 
  title <- paste(q," BY CATEGORY")
  df <- df_graphs 
  
  x <- multi_sd(df, left, right, x = q, y = g, color = g) + 
      labs(title  = q) 
 
  box_c_question[[i]] <- x
  ggsave(plot = x, path="figs/by_q_for_all_categories", filename =paste0(q,"_box.png"))
  
  
  
  ############RAINCLOUDS
  # setup dataframe 
  title <- paste(q," BY CATEGORY")
  df <- df_sd_questions_long %>% filter(QUESTION ==q)
  left <-   ref_labels[q,]$left
  right <-  ref_labels[q,]$right

  #RAINCLOUD PLOT
  x <- ggplot(df, aes(y = STIMULUS_CATEGORY , x = value, fill = STIMULUS_CATEGORY)) +
      stat_slab(normalize="groups", scale = 0.7) +
      stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
  guides(
    y = guide_axis_manual(labels = left),
    y.sec = guide_axis_manual(labels = right)
  ) +
  labs (title = title) +
  theme_minimal() 
   
  
  rain_c_question[[i]] <- x
  ggsave(plot = x, path="figs/by_q_for_all_categories", filename =paste0(q,"_rain.png"), units = c("in"), width = 10, height = 14  )

  
}

#GIVE NAMES TO LIST
#NOW CAN ACCESS plots by plots_c_question$MAKER_DESIGN
#ALSO plots_c_question$MAKER_DESIGN[[1]]
names(box_c_question) <- questions
names(rain_c_question) <- questions
rm(x, i, right, left, df)
  
#############################################################################

}

```



# STASH

wip code stash

## GGSTATSPLOT

### ggbarstats

```{r}

# GGSTATSPLOT BAR CHART
# ggstatsplot::ggbarstats(df, x= D_age, y=Progress,
#                           results.subtitle = FALSE,
#                           legend.title = "Age", 
#                           xlab = "") +
#     scale_fill_viridis(discrete=TRUE, option="viridis", direction=-1) +
#     labs (
#           title = "Participant AGE", x = "",
#           caption = "As expected, the [smaller] sample of Tumblr participants skews younger than Prolific") + 
#  theme_minimal() 

```

### COLOR palettes

```{r}

#DISPLAY COLOR PALETTE
#display.brewer.pal(n = 8, name = 'Dark2')

#DISPLAY COLOR PALETTE
# paletteer_d("Redmonder::dPBIPuGn")

```

### DISTRIBUTION plots
```{r stash-SAMPLE-DISTRIBUTION-PLOTS}

# #SET UP DATAFRAME
# df <- df_data
# 
# ## DENSITY HISTOGRAPH
# ggplot(data = df_data, aes( x = duration.min, fill = Assigned.Block)) +
#   geom_density(alpha = 0.5) +
#   facet_grid(rows = vars(Assigned.Block)) +
#   labs( x = "Survey Response Time (mins)",
#         title = "TOTAL Response Time by Sample",
#         subtitle = "(expect similiar across samples)") +
#   easy_add_legend_title("Sample") +
#   theme_minimal()
# 
# 
# ## RAINCLOUD
# ggplot(df, aes(x = duration.min, y = fct_rev(Assigned.Block), fill = fct_rev(Assigned.Block))) +
#   stat_slab(aes(thickness = after_stat(pdf*n), alpha=0.5), scale = 0.7) +
#   stat_dotsinterval(side = "bottom", scale = 0.7, slab_linewidth = NA) +
#   scale_fill_discrete(direction=-1)+
#   xlim(0,225) +
#   labs( x = "Survey Response Time (mins)", y="",
#         title = "TOTAL Response Time by Sample",
#         subtitle = "(expect similiar across samples)") +
#   theme_minimal() +
#   easy_remove_legend()
# 
# 
# ##RIDGEPLOT
# ggplot(df, aes(x = duration.min, y = fct_rev(Assigned.Block), fill = fct_rev(Assigned.Block))) +
#   geom_density_ridges(scale=0.9) +
#   # geom_boxplot()+
#   stat_pointinterval()+
#   theme_ridges() +
#   scale_fill_discrete(direction=-1)+
#   theme(legend.position = "none") +
#     labs( x = "Survey Response Time (mins)", y="",
#         title = "TOTAL Response Time by Sample",
#         subtitle = "(expect similiar across samples)")


```

### all-q for stimulus
```{r stash-SAMPLE-ALLQ-BY-STIMULUS}

# s = "B0-0" #stimulus code
# t = "STIMULUS B0 — MILLENIAL PINK PLANTS" #STIMULUS TITLE
# 
# #FILTER DATAFRAME
# df <- df_graphs %>% filter(STIMULUS == s)
# 
# 
# #BUILD SEMANTIC DIFFERENTIALS
# m_design <- single_sd(df, "professional", "layperson", x = MAKER_DESIGN) +
#       labs(title  = "MAKER-DESIGN") +
#       easy_remove_legend()
# 
# m_data <- single_sd(df, "professional", "layperson", x = MAKER_DATA) +
#       labs(title  = "MAKER-DATA") +
#       easy_remove_legend()
# 
# m_politics <- single_sd(df, "left-leaning", "right-leaning", x = MAKER_POLITIC) +
#       labs(title  = "MAKER-POLITICS") +
#       easy_remove_legend()
# 
# m_argue <- single_sd(df, "confrontational", "diplomatic", x = MAKER_ARGUE) +
#       labs(title  = "MAKER-ARGUE") +
#       easy_remove_legend()
# 
# m_selfish <- single_sd(df, "altruistic", "selfish", x = MAKER_SELF) +
#       labs(title  = "MAKER-SELFISH") +
#       easy_remove_legend()
# 
# m_align <- single_sd(df, "does NOT share", "does share", x = MAKER_ALIGN) +
#       labs(title  = "MAKER-ALIGNMENT") +
#       easy_remove_legend()
# 
# m_trust <- single_sd(df, "untrustworthy", "trustworthy", x = MAKER_TRUST) +
#       labs(title  = "MAKER-TRUST") +
#       easy_remove_legend()
# 
# 
# #BUILD MASTER PLOT
# PLOT_maker <- (m_design / m_data / m_politics / m_argue / m_selfish / m_align / m_trust) +
#   plot_annotation(
#     title = t,
#     subtitle =""
#   )
# 
# PLOT_maker

```

### all-q for stimulus - grouped
```{r stash-SAMPLE-ALLQ-BY-STIMULUS-GROUPED}

#  s = "B0-0" #stimulus code
#  t = "STIMULUS B0 — MILLENIAL PINK PLANTS" #STIMULUS TITLE
#  g = "Assigned.Block"
#  ##can also use y and color to split by additional variable 
#  
#  #FILTER DATAFRAME
#  df <- df_graphs %>% filter(STIMULUS == s)
# 
#  #BUILD SEMANTIC DIFFERENTIALS
#  m_design <- multi_sd(df, "professional", "layperson", x = "MAKER_DESIGN", y = g, color = g) +
#        labs(title  = "MAKER-DESIGN") +
#        easy_remove_legend()
# 
#  m_data <- multi_sd(df, "professional", "layperson", x = "MAKER_DATA", y = g, color = g) +
#        labs(title  = "MAKER-DATA") +
#        easy_remove_legend()
# 
#  m_politics <- multi_sd(df, "left-leaning", "right-leaning", x = "MAKER_POLITIC", y = g, color = g) +
#        labs(title  = "MAKER-POLITICS") +
#        easy_remove_legend()
# 
#  m_argue <- multi_sd(df, "confrontational", "diplomatic", x = "MAKER_ARGUE", y = g, color = g) +
#        labs(title  = "MAKER-ARGUE") +
#        easy_remove_legend()
# 
#  m_selfish <- multi_sd(df, "altruistic", "selfish", x = "MAKER_SELF", y = g, color = g) +
#        labs(title  = "MAKER-SELFISH") +
#        easy_remove_legend()
# 
#  m_align <- multi_sd(df, "does NOT share", "does share", x = "MAKER_ALIGN", y = g, color = g) +
#        labs(title  = "MAKER-ALIGNMENT") +
#        easy_remove_legend()
# 
#  m_trust <- multi_sd(df, "untrustworthy", "trustworthy", x = "MAKER_TRUST", y = g, color = g) +
#        labs(title  = "MAKER-TRUST") 
# 
# 
#  #BUILD MASTER PLOT
#  PLOT_maker <- (m_design / m_data / m_politics / m_argue / m_selfish / m_align / m_trust) +
#    plot_annotation(
#      title = t,
#      subtitle =""
#    )
# 
#  PLOT_maker
```

### across Blocks
```{r stash-across-blocks}
######### MAKER ATTRIBUTES ########################
# vals = c("datacollar", "bluecollar")
# leftside <- rep ("PROFESSIONAL",n_blocks )
# rightside <-rep ("LAYPERSON",n_blocks ) 
# b00_m_design <- ggplot(df, aes(y = MAKER_DESIGN, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-DESIGN")

# b00_m_data <- ggplot(df, aes(y = MAKER_DATA, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-DATA")


# leftside <- rep ("LEFT-WING",n_blocks )
# rightside <-rep ("RIGHT-WING",n_blocks ) 
# b00_m_politics <- ggplot(df, aes(y = MAKER_POLITIC, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-POLITICS")
  

# leftside <- rep ("CONFRONTATIONAL",n_blocks )
# rightside <-rep ("DIPLOMATIC",n_blocks ) 
# b00_m_argue <- ggplot(df, aes(y = MAKER_ARGUE, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-ARGUE")
  
# leftside <- rep ("ALTRUSITC",n_blocks )
# rightside <-rep ("SELFISH",n_blocks ) 
# b00_m_selfish <- ggplot(df, aes(y = MAKER_SELF, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-SELFISH")

# 
# leftside <- rep ("Does NOT",n_blocks )
# rightside <-rep ("DOES",n_blocks ) 
# b00_m_align <- ggplot(df, aes(y = MAKER_ALIGN, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-SHARES-MY-VALUES")

# leftside <- rep ("UNTRUSTWORTHY",n_blocks )
# rightside <-rep ("TRUSTWORTHY",n_blocks ) 
# b00_m_trust <- ggplot(df, aes(y = MAKER_TRUST, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   # easy_remove_legend() +
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-TRUST")
# 
# PLOT_b0_maker <- (b00_m_design / b00_m_data / b00_m_politics / b00_m_argue / b00_m_selfish / b00_m_align / b00_m_trust) + 
#   plot_annotation(
#     title = "STIMULUS B0 — MILLENIAL PINK PLANTS",
#     subtitle =""
#   )
# 
# PLOT_b0_maker
###################################################
```

### single Block
```{r stash-single-block}

# #FILTER DATAFRAME
# df <- df_graphs %>% filter(STIMULUS == "B0-0")
# 
# ######### MAKER ATTRIBUTES ########################
# vals = c("datacollar", "bluecollar")
# leftside <- rep ("PROFESSIONAL",1 )
# rightside <-rep ("LAYPERSON",1 ) 
# b_m_design <- ggplot(df, aes(y = MAKER_DESIGN, x = ""))+
#   geom_boxplot(width = 0.5) +
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-DESIGN")
# 
# b_m_data <- ggplot(df, aes(y = MAKER_DATA, x = ""))+
#   geom_boxplot(width = 0.5) +
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-DATA")
# 
# 
# leftside <- rep ("LEFT-WING",1 )
# rightside <-rep ("RIGHT-WING",1 ) 
# b_m_politics <- ggplot(df, aes(y = MAKER_POLITIC, x = ""))+
#   geom_boxplot(width = 0.5) +
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-POLITICS")
#   
# 
# leftside <- rep ("CONFRONTATIONAL",1 )
# rightside <-rep ("DIPLOMATIC",1 ) 
# b_m_argue <- ggplot(df, aes(y = MAKER_ARGUE, x = ""))+
#   geom_boxplot(width = 0.5) +
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-ARGUE")
#   
# leftside <- rep ("ALTRUSITC",1 )
# rightside <-rep ("SELFISH",1 ) 
# b_m_selfish <- ggplot(df, aes(y = MAKER_SELF, x = ""))+
#   geom_boxplot(width = 0.5) +
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-SELFISH")
# 
# 
# leftside <- rep ("Does NOT",1 )
# rightside <-rep ("DOES",1 ) 
# b_m_align <- ggplot(df, aes(y = MAKER_ALIGN, x = ""))+
#   geom_boxplot(width = 0.5) +
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-SHARES-MY-VALUES")
# 
# leftside <- rep ("UNTRUSTWORTHY",1 )
# rightside <-rep ("TRUSTWORTHY",1 ) 
# b_m_trust <- ggplot(df, aes(y = MAKER_TRUST, x = ""))+
#   geom_boxplot(width = 0.5) +
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-TRUST")
# 
# 
# PLOT_b_maker <- (b_m_design / b_m_data / b_m_politics / b_m_argue / b_m_selfish / b_m_align / b_m_trust) + 
#   plot_annotation(
#     title = paste(unique(df$STIMULUS), "MAKER")
#   )
# 
# PLOT_b_maker
###################################################
```

### single Block grouped
```{r stash-single-block-grouped}
# 
# #FILTER DATAFRAME
# df <- df_graphs %>% filter(STIMULUS == "B0-0")
# 
# ######### MAKER ATTRIBUTES ########################
# vals = c("datacollar", "bluecollar")
# leftside <- rep ("PROFESSIONAL",1 )
# rightside <-rep ("LAYPERSON",1 ) 
# b_m_design <- ggplot(df, aes(y = MAKER_DESIGN, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-DESIGN")
# 
# b_m_data <- ggplot(df, aes(y = MAKER_DATA, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-DATA")
# 
# 
# leftside <- rep ("LEFT-WING",1 )
# rightside <-rep ("RIGHT-WING",1 ) 
# b_m_politics <- ggplot(df, aes(y = MAKER_POLITIC, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-POLITICS")
#   
# 
# leftside <- rep ("CONFRONTATIONAL",1 )
# rightside <-rep ("DIPLOMATIC",1 ) 
# b_m_argue <- ggplot(df, aes(y = MAKER_ARGUE, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-ARGUE")
#   
# leftside <- rep ("ALTRUSITC",1 )
# rightside <-rep ("SELFISH",1 ) 
# b_m_selfish <- ggplot(df, aes(y = MAKER_SELF, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-SELFISH")
# 
# 
# leftside <- rep ("Does NOT",1 )
# rightside <-rep ("DOES",1 ) 
# b_m_align <- ggplot(df, aes(y = MAKER_ALIGN, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-SHARES-MY-VALUES")
# 
# leftside <- rep ("UNTRUSTWORTHY",1 )
# rightside <-rep ("TRUSTWORTHY",1 ) 
# b_m_trust <- ggplot(df, aes(y = MAKER_TRUST, x = ID.Study, color = ID.Study))+
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   labs(x="", y="") +
#   coord_flip() + 
#   theme_minimal() + 
#   easy_remove_legend() + 
#   guides(
#   y = guide_axis_manual(
#   #breaks = vals, 
#   labels = leftside  
#   ),
#   y.sec = guide_axis_manual(
#   #breaks = vals, 
#   labels = rightside
# )) + 
#   labs(title  = "MAKER-TRUST")
# 
# 
# PLOT_b_maker <- (b_m_design / b_m_data / b_m_politics / b_m_argue / b_m_selfish / b_m_align / b_m_trust) + 
#   plot_annotation(
#     title = paste(unique(df$STIMULUS), "MAKER")
#   )
# 
# PLOT_b_maker
# ###################################################
```

### graph matrix
```{r stash-graph-matrix}




# #### 
# q = "MAKER_DESIGN"
# df <- df_questions %>% filter(QUESTION == q) %>% 
#   mutate(
#     value = as.numeric(value),
#     STIMULUS_CATEGORY = str_remove(STIMULUS,"B.-"),
#     STIMULUS_CATEGORY = factor(STIMULUS_CATEGORY,
#                   levels=c("0","1","2","3","4"),
#                   labels= c("F","A","B","C","D"))
# )
# 
# 
# g <- ggplot(df, aes(y = value, x="", color = STIMULUS_CATEGORY)) +
#     geom_boxplot(width = 0.5)+
#     geom_jitter(width = 0.1, alpha=0.3) + 
#     scale_y_continuous(limits=c(-1,101)) +
#     labs(x="", y="") +
#     coord_flip()  +
#     facet_grid(df$STIMULUS_CATEGORY ~ .) + 
#     labs(title=df$STIMULUS_CATEGORY) + 
#     guides(
#         y = guide_axis_manual(labels = ref_labels[q,"left"]),
#         y.sec = guide_axis_manual(labels = ref_labels[q,"right"])
#       ) +  
#   theme_minimal()  + 
#   labs (title = q)
# 
# g
# left <- rep(ref_labels[q,"left"], length(unique(df$STIMULUS_CATEGORY)))
# right <- rep(ref_labels[q,"left"], length(unique(df$STIMULUS_CATEGORY)))
# a <- multi_sd(df, x = value, y = QUESTION, color = STIMULUS_CATEGORY, left=, right=right)
# 
# 
# multi_sd <- function (df, x, y, color, left,right) { 
#   
#   g <- ggplot(df, aes(y = {{x}}, x = {{y}}, color = {{color}}))+
#   geom_boxplot(width = 0.5) + 
#   geom_jitter(width = 0.1, alpha=0.5) + 
#   scale_y_continuous(limits=c(-1,101)) +
#   facet_grid(rows=vars({{color}})) +
#   labs(x="", y="") +
#   coord_flip() + 
#   guides(
#     y = guide_axis_manual(labels = left),
#     y.sec = guide_axis_manual(labels = right)
#   ) + theme_minimal() 
#   
#   return(g)
# }




# ## GROUPED PLOTSD FUNCTION 
# grouped_plotsd = function (data, x, type, q, boxplot) {
#   ggplot(df, aes(y = .data[[x]], x="")) +
#     {if(boxplot) geom_boxplot(width = 0.5) } +
#     geom_jitter(width = 0.1, alpha=0.3) + 
#     scale_y_continuous(limits=c(-1,101)) +
#     labs(x="", y="") +
#     coord_flip()  +
#     {if(type == "Q")
#       guides(
#         y = guide_axis_manual(labels = ref_labels[q,"left"]),
#         y.sec = guide_axis_manual(labels = ref_labels[q,"right"])
#       )} +  
#   theme_minimal()  + 
#      labs (
#        caption = column
#      )
# }


#####################################################################

# # stim <- "B1-1"
# 
# # setup dataframe 
# title <- ref_stimuli %>% filter(ID ==stim) %>% select(NAME) ##TODO IF NOT WORK ref_stim_id
# title <- paste(stim,"|",title)
# df <- df_graphs %>% filter(STIMULUS==stim)
# 
# #subset data cols 
# d <- df %>% select( all_of(questions))
# plots <- as.list(lapply(colnames(d), plotsd, data = df, boxplot=TRUE))
# 
# ## PICK UP HERE, FIGURE OUT HOW TO LOOP OVER STIM
# 
# x <- plots[[1]] / plots[[2]] / plots[[3]] / plots[[4]] / plots[[5]] / plots[[6]] / plots[[7]] /
#   plots[[8]] /plots[[9]] /plots[[10]] /plots[[11]] + 
#   plot_annotation(
#     title = title,
#     subtitle =""
#   )
# x
# ggsave(plot = x, filename =paste(stim,".png"), units = c("in"), width = 10, height = 14  )




#CREATE MATRIX 
# m <- matrix(nrow = length(stim), ncol = length(questions)) 
# rownames(m) <- stim
# colnames(m) <- questions

##END OF FILE

```



## TEMP JOB TALK STUFF

```{r}
data(iris)
library(ggpubr)
# Scatter plot colored by groups ("Species")
sp <- ggscatter(iris, x = "Sepal.Length", y = "Sepal.Width",
                color = "Species",
                size = 2, alpha = 0.6)+
  border()                                         
# Marginal density plot of x (top panel) and y (right panel)
xplot <- ggdensity(iris, "Sepal.Length", fill = "Species")
yplot <- ggdensity(iris, "Sepal.Width", fill = "Species")+
  rotate()
# Cleaning the plots
yplot <- yplot + clean_theme() 
xplot <- xplot + clean_theme()
# Arranging the plot
ggarrange(xplot, NULL, sp, yplot, 
          ncol = 2, nrow = 2,  align = "hv", 
          widths = c(2, 1), heights = c(1, 2),
          common.legend = TRUE)

```

```{r}
# library
library(ggplot2)
library(ggExtra)
library(palmerpenguins) 


p <- ggplot(penguins, aes(x = bill_length_mm, y=bill_depth_mm, colour = species)) +
  geom_point() + theme(legend.position = "bottom") 

ggMarginal(p, groupColour = TRUE, groupFill = TRUE)  


p <- ggplot(penguins, aes(x = bill_length_mm, y=bill_depth_mm, colour = species)) +
  geom_point() + theme_minimal() + theme(legend.position = "bottom") +
  scale_color_viridis(discrete=TRUE, option="viridis", direction=-1) 

ggMarginal(p, groupColour = TRUE, groupFill = TRUE)  

```


# RESOURCES

- custom color palettes: https://www.r-bloggers.com/2022/06/custom-colour-palettes-for-ggplot2/